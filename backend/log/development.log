  [1m[35m (269.3ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35m (227.2ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35m (344.0ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35m (242.3ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35m (239.9ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35m (234.1ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35m (325.3ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35m (251.4ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (557.0ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35m (247.4ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_test" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (134.0ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (473.3ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_test" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35m (12.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY) /*application='NexumPoc'*/[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'development', '2025-12-19 09:04:43.704800', '2025-12-19 09:04:43.704803') RETURNING "key" /*application='NexumPoc'*/[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.1ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.1ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (143.5ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.1ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (102.7ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_test" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
Migrating to CreateTones (20251219090625)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[35m (14.0ms)[0m  [1m[35mCREATE TABLE "tones" ("id" bigserial primary key, "name" character varying, "instructions" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251219090625') RETURNING "version" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mTone Load (1.2ms)[0m  [1m[34mSELECT "tones".* FROM "tones" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (4.0ms)[0m  [1m[32mINSERT INTO "tones" ("name", "instructions", "created_at", "updated_at") VALUES ('Istituzionale', 'Sei un assistente formale. Usa un linguaggio burocratico, dai del Lei, usa la forma passiva. Sii molto distaccato e professionale.', '2025-12-19 09:08:05.333429', '2025-12-19 09:08:05.333429') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (3.4ms)[0m  [1m[32mINSERT INTO "tones" ("name", "instructions", "created_at", "updated_at") VALUES ('Simpatico', 'Sei un amico. Dai del tu, usa qualche emoji, sii breve e diretto. Usa un linguaggio colorito e positivo.', '2025-12-19 09:08:05.347050', '2025-12-19 09:08:05.347050') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (3.4ms)[0m  [1m[32mINSERT INTO "tones" ("name", "instructions", "created_at", "updated_at") VALUES ('Venditore', 'Sei un esperto di marketing. Usa linguaggio persuasivo, sottolinea i vantaggi, crea urgenza. L''obiettivo Ã¨ convincere.', '2025-12-19 09:08:05.356171', '2025-12-19 09:08:05.356171') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
Started POST "/genera" for ::1 at 2025-12-19 10:45:32 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico"}}
  [1m[36mTone Load (1.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:12:in 'AiService#genera'
Completed 500 Internal Server Error in 21935ms (Views: 0.2ms | ActiveRecord: 20.1ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 10:47:59 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico"}}
Completed 500 Internal Server Error in 21037ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 10:50:02 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico"}}
Completed 500 Internal Server Error in 21074ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 10:52:34 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico"}}
Completed 500 Internal Server Error in 21076ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 10:53:13 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico"}}
Completed 500 Internal Server Error in 21038ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 10:54:31 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico"}}
  [1m[36mTone Load (0.3ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
Completed 500 Internal Server Error in 21048ms (Views: 0.2ms | ActiveRecord: 2.7ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 10:58:32 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico"}}
  [1m[36mTone Load (1.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:15:in 'AiService#genera'
Completed 500 Internal Server Error in 933ms (Views: 0.2ms | ActiveRecord: 19.5ms (1 query, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-19 10:59:36 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico"}}
  [1m[36mTone Load (1.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:15:in 'AiService#genera'
Completed 500 Internal Server Error in 799ms (Views: 0.7ms | ActiveRecord: 19.7ms (1 query, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-19 11:01:35 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico"}}
  [1m[36mTone Load (1.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:15:in 'AiService#genera'
Completed 500 Internal Server Error in 872ms (Views: 0.2ms | ActiveRecord: 19.2ms (1 query, 0 cached) | GC: 0.3ms)


Started POST "/genera" for ::1 at 2025-12-19 11:02:06 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico"}}
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:16:in 'AiService#genera'
Completed 500 Internal Server Error in 745ms (Views: 0.1ms | ActiveRecord: 2.3ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 11:06:31 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico"}}
  [1m[36mTone Load (1.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:16:in 'AiService#genera'
Completed 500 Internal Server Error in 896ms (Views: 0.2ms | ActiveRecord: 19.6ms (1 query, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-19 11:11:26 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Simpatico"}}
  [1m[36mTone Load (0.3ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:16:in 'AiService#genera'
Completed 200 OK in 2447ms (Views: 0.1ms | ActiveRecord: 2.8ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 11:15:33 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Serio", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Serio"}}
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."name" = 'Serio' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:16:in 'AiService#genera'
Completed 200 OK in 4813ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (2.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
Migrating to CreateCompaniesAndLinkTones (20251219120000)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[35m (11.1ms)[0m  [1m[35mCREATE TABLE "companies" ("id" bigserial primary key, "name" character varying NOT NULL, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "tones" ADD "company_id" bigint /*application='NexumPoc'*/[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE INDEX "index_tones_on_company_id" ON "tones" ("company_id") /*application='NexumPoc'*/[0m
  [1m[35m (5.1ms)[0m  [1m[35mALTER TABLE "tones" ADD CONSTRAINT "fk_rails_defed01769"
FOREIGN KEY ("company_id")
  REFERENCES "companies" ("id")
 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251219120000') RETURNING "version" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.1ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mCompany Create (2.0ms)[0m  [1m[32mINSERT INTO "companies" ("id", "name", "description", "created_at", "updated_at") VALUES (1, 'Acme', 'Suite B2B', '2025-12-19 10:52:51.992147', '2025-12-19 10:52:51.992147') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (2.7ms)[0m  [1m[32mINSERT INTO "tones" ("name", "instructions", "created_at", "updated_at", "company_id") VALUES ('Simpatico', 'Tono amichevole e leggero', '2025-12-19 10:53:02.630706', '2025-12-19 10:53:02.630706', 1) RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
Started POST "/genera" for ::1 at 2025-12-19 12:01:06 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Serio", "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Serio"}}
Completed 422 Unprocessable Content in 18ms (Views: 0.2ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 12:01:43 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Serio", "company_id" => 1, "generator" => {"prompt" => "Spiega cos'Ã¨ il cloud computing a un bambino", "tone" => "Serio", "company_id" => 1}}
  [1m[36mCompany Load (1.6ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:16:in 'AiService#genera'
  [1m[36mTone Load (1.7ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Serio' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:17:in 'AiService#genera'
Completed 500 Internal Server Error in 1043ms (Views: 0.2ms | ActiveRecord: 136.7ms (2 queries, 0 cached) | GC: 0.3ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:46:35 +0100
Started GET "/favicon.ico" for ::1 at 2025-12-19 15:46:35 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/favicon.ico"):
  
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (1.8ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 267ms (Views: 19.8ms | ActiveRecord: 21.5ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:46:40 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 4ms (Views: 3.3ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:47:00 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 4ms (Views: 3.2ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:47:06 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 6ms (Views: 5.2ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:47:07 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 4ms (Views: 3.5ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:48:15 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (1.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 323ms (Views: 7.8ms | ActiveRecord: 20.5ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:48:41 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 4ms (Views: 3.3ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-19 15:48:46 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 0 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 4ms (Views: 3.6ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:49:42 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (0.6ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 11ms (Views: 9.9ms | ActiveRecord: 0.6ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:49:45 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (0.3ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 3ms (Views: 2.9ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:49:46 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 4ms (Views: 3.6ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)


  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mTone Pluck (1.5ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*application='NexumPoc'*/[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:50:32 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 4ms (Views: 3.0ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:51:46 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 200 OK in 4ms (Views: 3.0ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:53:13 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:30:in 'GeneratorController#index'
  [1m[36mTone Load (1.5ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:34:in 'GeneratorController#index'
Completed 200 OK in 209ms (Views: 5.2ms | ActiveRecord: 22.8ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:53:27 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:30:in 'GeneratorController#index'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:34:in 'GeneratorController#index'
Completed 200 OK in 14ms (Views: 4.6ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=2" for ::1 at 2025-12-19 15:53:52 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "2"}
  [1m[36mCompany Load (0.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 2 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:30:in 'GeneratorController#index'
Completed 404 Not Found in 4ms (Views: 0.2ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-19 15:53:55 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:30:in 'GeneratorController#index'
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 15:53:56 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:30:in 'GeneratorController#index'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:34:in 'GeneratorController#index'
Completed 200 OK in 7ms (Views: 3.2ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


  [1m[36mTone Load (1.4ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions", "tones"."company_id" FROM "tones" /* loading for pp */ LIMIT 11 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (5283.2ms)[0m  [1m[35mDROP DATABASE IF EXISTS "nexum_poc_development" /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (5288.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "nexum_poc_development" /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (203.7ms)[0m  [1m[35mDROP DATABASE IF EXISTS "nexum_poc_development" /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (5288.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "nexum_poc_test" /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (364.1ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.1ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (118.7ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_test" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.7ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql" SCHEMA pg_catalog /*application='NexumPoc'*/[0m
  [1m[35m (1.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "companies" CASCADE /*application='NexumPoc'*/[0m
  [1m[35m (11.7ms)[0m  [1m[35mCREATE TABLE "companies" ("id" bigserial primary key, "created_at" timestamp(6) NOT NULL, "description" text, "name" character varying NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "tones" CASCADE /*application='NexumPoc'*/[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "tones" ("id" bigserial primary key, "company_id" bigint, "created_at" timestamp(6) NOT NULL, "instructions" text, "name" character varying, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_tones_on_company_id" ON "tones" ("company_id") /*application='NexumPoc'*/[0m
  [1m[35m (3.9ms)[0m  [1m[35mALTER TABLE "tones" ADD CONSTRAINT "fk_rails_defed01769"
FOREIGN KEY ("company_id")
  REFERENCES "companies" ("id")
 /*application='NexumPoc'*/[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251219120000) /*application='NexumPoc'*/[0m
  [1m[35m (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20251219090625); /*application='NexumPoc'*/[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'development', '2025-12-19 15:05:32.619753', '2025-12-19 15:05:32.619755') RETURNING "key" /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'schema_sha1' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', '79e90ba20116a27beadebd0bf0381b3372fc919a', '2025-12-19 15:05:32.627307', '2025-12-19 15:05:32.627308') RETURNING "key" /*application='NexumPoc'*/[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mTone Delete All (1.6ms)[0m  [1m[31mDELETE FROM "tones" /*application='NexumPoc'*/[0m
  [1m[36mCompany Delete All (0.3ms)[0m  [1m[31mDELETE FROM "companies" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mCompany Create (3.6ms)[0m  [1m[32mINSERT INTO "companies" ("id", "created_at", "description", "name", "updated_at") VALUES (1, '2025-12-19 15:05:32.815093', 'Suite B2B', 'Acme', '2025-12-19 15:05:32.815093') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (4.2ms)[0m  [1m[32mINSERT INTO "tones" ("company_id", "created_at", "instructions", "name", "updated_at") VALUES (1, '2025-12-19 15:05:32.845446', 'Tono amichevole e leggero', 'Simpatico', '2025-12-19 15:05:32.845446') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (3.3ms)[0m  [1m[32mINSERT INTO "tones" ("company_id", "created_at", "instructions", "name", "updated_at") VALUES (1, '2025-12-19 15:05:32.855882', 'Tono professionale e conciso', 'Formale', '2025-12-19 15:05:32.855882') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (3.4ms)[0m  [1m[32mINSERT INTO "tones" ("company_id", "created_at", "instructions", "name", "updated_at") VALUES (1, '2025-12-19 15:05:32.864940', 'Tono autorevole e preciso', 'Istituzionale', '2025-12-19 15:05:32.864940') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTone Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "tones" WHERE "tones"."company_id" = 1 /*application='NexumPoc'*/[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:05:45 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:30:in 'GeneratorController#index'
  [1m[36mTone Load (1.5ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:34:in 'GeneratorController#index'
Completed 200 OK in 235ms (Views: 7.4ms | ActiveRecord: 23.5ms (2 queries, 0 cached) | GC: 0.6ms)


Started POST "/genera" for ::1 at 2025-12-19 16:06:01 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto elite suito T", "tone" => "Istituzionale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto elite suito T", "tone" => "Istituzionale", "company_id" => 1}}
  [1m[36mCompany Load (0.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 500 Internal Server Error in 21317ms (Views: 0.1ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:09:16 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.2ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:30:in 'GeneratorController#index'
  [1m[36mTone Load (1.8ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:34:in 'GeneratorController#index'
Completed 200 OK in 209ms (Views: 5.5ms | ActiveRecord: 23.3ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 16:09:27 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto elite drivo \n", "tone" => "Formale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto elite drivo \n", "tone" => "Formale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 500 Internal Server Error in 698ms (Views: 0.2ms | ActiveRecord: 0.9ms (2 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:11:20 +0100
  [1m[36mActiveRecord::SchemaMigration Load (2.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (1.7ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 347ms (Views: 7.1ms | ActiveRecord: 26.5ms (2 queries, 0 cached) | GC: 0.3ms)


Started POST "/genera" for ::1 at 2025-12-19 16:11:29 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto elite suito t\n", "tone" => "Istituzionale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto elite suito t\n", "tone" => "Istituzionale", "company_id" => 1}}
  [1m[36mCompany Load (0.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (1.0ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Errore interno: Aws::BedrockRuntime::Errors::AccessDeniedException - User: arn:aws:sts::616293267833:assumed-role/AWSReservedSSO_Bedrock-Bugbuster_b06a107882c8568a/bugbuster.unipd is not authorized to perform: bedrock:InvokeModel on resource: arn:aws:bedrock:us-east-1::foundation-model/anthropic.claude-3-sonnet-20240229-v1:0 because no identity-based policy allows the bedrock:InvokeModel action
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:3364:in 'Aws::BedrockRuntime::Client#invoke_model'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:43:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:12:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 767ms (Views: 0.1ms | ActiveRecord: 1.5ms (2 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:13:08 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (1.7ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 233ms (Views: 5.5ms | ActiveRecord: 23.6ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 16:13:10 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Errore interno: Aws::BedrockRuntime::Errors::UnrecognizedClientException - The security token included in the request is invalid.
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:3364:in 'Aws::BedrockRuntime::Client#invoke_model'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:43:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:12:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 683ms (Views: 0.2ms | ActiveRecord: 1.0ms (2 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/" for ::1 at 2025-12-19 16:15:33 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by Rails::WelcomeController#index as HTML
  Rendering C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/templates/rails/welcome/index.html.erb
  Rendered C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/templates/rails/welcome/index.html.erb (Duration: 0.6ms | GC: 0.0ms)
Completed 200 OK in 77ms (Views: 7.7ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/icon.png" for ::1 at 2025-12-19 16:15:33 +0100
  
ActionController::RoutingError (No route matches [GET] "/icon.png"):
  
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:15:45 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
Started GET "/favicon.ico" for ::1 at 2025-12-19 16:15:45 +0100
  
ActionController::RoutingError (No route matches [GET] "/favicon.ico"):
  
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (1.7ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 205ms (Views: 5.7ms | ActiveRecord: 31.3ms (2 queries, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-19 16:15:53 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto elite suito T", "tone" => "Istituzionale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto elite suito T", "tone" => "Istituzionale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Errore interno: Aws::BedrockRuntime::Errors::AccessDeniedException - User: arn:aws:sts::616293267833:assumed-role/AWSReservedSSO_Bedrock-Bugbuster_b06a107882c8568a/bugbuster.unipd is not authorized to perform: bedrock:InvokeModel on resource: arn:aws:bedrock:us-east-1::foundation-model/anthropic.claude-3-sonnet-20240229-v1:0 because no identity-based policy allows the bedrock:InvokeModel action
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:3364:in 'Aws::BedrockRuntime::Client#invoke_model'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:43:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:12:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 732ms (Views: 0.1ms | ActiveRecord: 0.9ms (2 queries, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-19 16:16:39 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto elite suito T", "tone" => "Istituzionale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto elite suito T", "tone" => "Istituzionale", "company_id" => 1}}
  [1m[36mCompany Load (0.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 3035ms (Views: 0.2ms | ActiveRecord: 4.0ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 16:17:19 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto Bugbuster profumatore ambientale, fatto dalla nostra azienda", "tone" => "Istituzionale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto Bugbuster profumatore ambientale, fatto dalla nostra azienda", "tone" => "Istituzionale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.6ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 7007ms (Views: 0.1ms | ActiveRecord: 0.9ms (2 queries, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-19 16:17:37 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto Bugbuster profumatore ambientale, fatto dalla nostra azienda", "tone" => "Formale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto Bugbuster profumatore ambientale, fatto dalla nostra azienda", "tone" => "Formale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 5766ms (Views: 0.1ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 16:17:49 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto Bugbuster profumatore ambientale, fatto dalla nostra azienda", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto Bugbuster profumatore ambientale, fatto dalla nostra azienda", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 14178ms (Views: 0.1ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:25:32 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.2ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 198ms (Views: 5.5ms | ActiveRecord: 23.1ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 16:25:44 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto bugbuster profumatore", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto bugbuster profumatore", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 9492ms (Views: 0.1ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:29:45 +0100
  [1m[36mActiveRecord::SchemaMigration Load (2.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.9ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:42:in 'GeneratorController#index'
  [1m[36mTone Load (2.3ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:46:in 'GeneratorController#index'
Completed 200 OK in 241ms (Views: 5.4ms | ActiveRecord: 24.7ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-19 16:30:50 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:42:in 'GeneratorController#index'
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:30:57 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:42:in 'GeneratorController#index'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:46:in 'GeneratorController#index'
Completed 200 OK in 7ms (Views: 3.2ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 16:31:10 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Presenta il prodotto tastiera con 20 tasti", "tone" => "Formale", "company_id" => 1, "generator" => {"prompt" => "Presenta il prodotto tastiera con 20 tasti", "tone" => "Formale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:12:in 'GeneratorController#create'
  [1m[36mTone Load (0.6ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
  [1m[36mCACHE Company Load (0.0ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mCACHE Tone Load (0.0ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 8380ms (Views: 0.1ms | ActiveRecord: 1.0ms (4 queries, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-19 16:31:25 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Presenta il prodotto tastiera con 20 tasti", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Presenta il prodotto tastiera con 20 tasti", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:12:in 'GeneratorController#create'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
  [1m[36mCACHE Company Load (0.0ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mCACHE Tone Load (0.0ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 5645ms (Views: 0.1ms | ActiveRecord: 0.8ms (4 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for 127.0.0.1 at 2025-12-19 16:32:40 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (1.4ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 217ms (Views: 5.5ms | ActiveRecord: 23.7ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for 127.0.0.1 at 2025-12-19 16:32:50 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for 127.0.0.1 at 2025-12-19 16:32:53 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (0.3ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 7ms (Views: 3.1ms | ActiveRecord: 0.7ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for 127.0.0.1 at 2025-12-19 16:33:07 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Presenta il prodotto tastiera con 3 tasti\n", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Presenta il prodotto tastiera con 3 tasti\n", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 6057ms (Views: 0.1ms | ActiveRecord: 0.9ms (2 queries, 0 cached) | GC: 0.3ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:34:44 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 224ms (Views: 6.1ms | ActiveRecord: 23.7ms (2 queries, 0 cached) | GC: 0.3ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-19 16:34:50 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:34:52 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 7ms (Views: 3.0ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 16:34:55 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Presenta il prodotto tastiera con 3 tasti", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Presenta il prodotto tastiera con 3 tasti", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 8192ms (Views: 0.1ms | ActiveRecord: 1.0ms (2 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:37:52 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (2.0ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (3.4ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 320ms (Views: 12.1ms | ActiveRecord: 45.5ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 16:37:55 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Presenta il prodotto tastiera con 3 tasti", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Presenta il prodotto tastiera con 3 tasti", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 5205ms (Views: 0.1ms | ActiveRecord: 0.9ms (2 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:39:42 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.1ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (1.5ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 225ms (Views: 6.4ms | ActiveRecord: 21.8ms (2 queries, 0 cached) | GC: 0.3ms)


Started POST "/genera" for ::1 at 2025-12-19 16:39:44 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Presenta il prodotto tastiera con 3 tasti", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Presenta il prodotto tastiera con 3 tasti", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 13458ms (Views: 0.1ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:44:11 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.2ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (1.8ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 230ms (Views: 6.5ms | ActiveRecord: 24.1ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 16:44:13 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Presenta il prodotto tastiera con 30 tasti", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Presenta il prodotto tastiera con 30 tasti", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 7732ms (Views: 0.1ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-19 16:44:30 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Presenta il prodotto tastiera con 30 tasti", "tone" => "Istituzionale", "company_id" => 1, "generator" => {"prompt" => "Presenta il prodotto tastiera con 30 tasti", "tone" => "Istituzionale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.3ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 7353ms (Views: 0.1ms | ActiveRecord: 0.7ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 16:44:53 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Presenta il prodotto tastiera con 30 tasti", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Presenta il prodotto tastiera con 30 tasti", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 7332ms (Views: 0.1ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=2" for ::1 at 2025-12-19 16:45:06 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "2"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 2 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-19 16:45:08 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-19 16:45:19 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.8ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
Completed 404 Not Found in 6ms (Views: 0.3ms | ActiveRecord: 0.7ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-19 16:45:20 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:46:24 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 15ms (Views: 9.7ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.2ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-19 16:46:27 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
Completed 404 Not Found in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-19 16:46:29 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
Completed 404 Not Found in 4ms (Views: 0.7ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-19 16:47:09 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
Completed 404 Not Found in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-19 16:47:11 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 11ms (Views: 5.2ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-19 16:47:15 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "comunica che ci sono ferie dal 2 al 10 gennaio 2026", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "comunica che ci sono ferie dal 2 al 10 gennaio 2026", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 2588ms (Views: 0.1ms | ActiveRecord: 0.9ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 16:47:23 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "comunica che ci sono ferie dal 2 al 10 gennaio 2026", "tone" => "Istituzionale", "company_id" => 1, "generator" => {"prompt" => "comunica che ci sono ferie dal 2 al 10 gennaio 2026", "tone" => "Istituzionale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 4852ms (Views: 0.1ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


  [1m[36mCACHE ActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mCACHE ActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mCACHE ActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 17:24:32 +0100
  [1m[36mActiveRecord::SchemaMigration Load (2.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

        bin/rails db:migrate

You have 1 pending migration:

db/migrate/20251219170000_create_generations.rb


):
  
activerecord (8.1.1) lib/active_record/migration.rb:743:in 'ActiveRecord::Migration.check_pending_migrations'
activerecord (8.1.1) lib/active_record/migration.rb:660:in 'block (2 levels) in ActiveRecord::Migration::CheckPending#call'
activesupport (8.1.1) lib/active_support/file_update_checker.rb:88:in 'ActiveSupport::FileUpdateChecker#execute'
activerecord (8.1.1) lib/active_record/migration.rb:665:in 'block in ActiveRecord::Migration::CheckPending#call'
activerecord (8.1.1) lib/active_record/migration.rb:657:in 'Thread::Mutex#synchronize'
activerecord (8.1.1) lib/active_record/migration.rb:657:in 'ActiveRecord::Migration::CheckPending#call'
actionpack (8.1.1) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.1) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.1) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.1) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.1) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.1) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.1) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.1) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.1) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.1) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.1) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
actionpack (8.1.1) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.1) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
actionpack (8.1.1) lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
railties (8.1.1) lib/rails/engine.rb:534:in 'Rails::Engine#call'
puma (7.1.0) lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
puma (7.1.0) lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
puma (7.1.0) lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
puma (7.1.0) lib/puma/request.rb:100:in 'Puma::Request#handle_request'
puma (7.1.0) lib/puma/server.rb:503:in 'Puma::Server#process_client'
puma (7.1.0) lib/puma/server.rb:262:in 'block in Puma::Server#run'
puma (7.1.0) lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 17:24:36 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

        bin/rails db:migrate

You have 1 pending migration:

db/migrate/20251219170000_create_generations.rb


):
  
activerecord (8.1.1) lib/active_record/migration.rb:743:in 'ActiveRecord::Migration.check_pending_migrations'
activerecord (8.1.1) lib/active_record/migration.rb:660:in 'block (2 levels) in ActiveRecord::Migration::CheckPending#call'
activesupport (8.1.1) lib/active_support/file_update_checker.rb:88:in 'ActiveSupport::FileUpdateChecker#execute'
activerecord (8.1.1) lib/active_record/migration.rb:665:in 'block in ActiveRecord::Migration::CheckPending#call'
activerecord (8.1.1) lib/active_record/migration.rb:657:in 'Thread::Mutex#synchronize'
activerecord (8.1.1) lib/active_record/migration.rb:657:in 'ActiveRecord::Migration::CheckPending#call'
actionpack (8.1.1) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.1) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.1) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.1) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.1) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.1) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.1) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.1) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.1) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.1) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.1) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
actionpack (8.1.1) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.1) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
actionpack (8.1.1) lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
railties (8.1.1) lib/rails/engine.rb:534:in 'Rails::Engine#call'
puma (7.1.0) lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
puma (7.1.0) lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
puma (7.1.0) lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
puma (7.1.0) lib/puma/request.rb:100:in 'Puma::Request#handle_request'
puma (7.1.0) lib/puma/server.rb:503:in 'Puma::Server#process_client'
puma (7.1.0) lib/puma/server.rb:262:in 'block in Puma::Server#run'
puma (7.1.0) lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 17:24:42 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

        bin/rails db:migrate

You have 1 pending migration:

db/migrate/20251219170000_create_generations.rb


):
  
activerecord (8.1.1) lib/active_record/migration.rb:743:in 'ActiveRecord::Migration.check_pending_migrations'
activerecord (8.1.1) lib/active_record/migration.rb:660:in 'block (2 levels) in ActiveRecord::Migration::CheckPending#call'
activesupport (8.1.1) lib/active_support/file_update_checker.rb:88:in 'ActiveSupport::FileUpdateChecker#execute'
activerecord (8.1.1) lib/active_record/migration.rb:665:in 'block in ActiveRecord::Migration::CheckPending#call'
activerecord (8.1.1) lib/active_record/migration.rb:657:in 'Thread::Mutex#synchronize'
activerecord (8.1.1) lib/active_record/migration.rb:657:in 'ActiveRecord::Migration::CheckPending#call'
actionpack (8.1.1) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.1) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.1) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.1) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.1) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.1) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.1) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.1) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.1) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.1) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.1) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
actionpack (8.1.1) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.1) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
actionpack (8.1.1) lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
railties (8.1.1) lib/rails/engine.rb:534:in 'Rails::Engine#call'
puma (7.1.0) lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
puma (7.1.0) lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
puma (7.1.0) lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
puma (7.1.0) lib/puma/request.rb:100:in 'Puma::Request#handle_request'
puma (7.1.0) lib/puma/server.rb:503:in 'Puma::Server#process_client'
puma (7.1.0) lib/puma/server.rb:262:in 'block in Puma::Server#run'
puma (7.1.0) lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Started GET "/generations?company_id=1" for ::1 at 2025-12-19 17:24:46 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

        bin/rails db:migrate

You have 1 pending migration:

db/migrate/20251219170000_create_generations.rb


):
  
activerecord (8.1.1) lib/active_record/migration.rb:743:in 'ActiveRecord::Migration.check_pending_migrations'
activerecord (8.1.1) lib/active_record/migration.rb:660:in 'block (2 levels) in ActiveRecord::Migration::CheckPending#call'
activesupport (8.1.1) lib/active_support/file_update_checker.rb:88:in 'ActiveSupport::FileUpdateChecker#execute'
activerecord (8.1.1) lib/active_record/migration.rb:665:in 'block in ActiveRecord::Migration::CheckPending#call'
activerecord (8.1.1) lib/active_record/migration.rb:657:in 'Thread::Mutex#synchronize'
activerecord (8.1.1) lib/active_record/migration.rb:657:in 'ActiveRecord::Migration::CheckPending#call'
actionpack (8.1.1) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.1) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.1) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.1) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.1) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.1) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.1) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.1) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.1) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.1) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.1) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
actionpack (8.1.1) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.1) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
actionpack (8.1.1) lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
railties (8.1.1) lib/rails/engine.rb:534:in 'Rails::Engine#call'
puma (7.1.0) lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
puma (7.1.0) lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
puma (7.1.0) lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
puma (7.1.0) lib/puma/request.rb:100:in 'Puma::Request#handle_request'
puma (7.1.0) lib/puma/server.rb:503:in 'Puma::Server#process_client'
puma (7.1.0) lib/puma/server.rb:262:in 'block in Puma::Server#run'
puma (7.1.0) lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Started POST "/genera" for ::1 at 2025-12-19 17:24:48 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

        bin/rails db:migrate

You have 1 pending migration:

db/migrate/20251219170000_create_generations.rb


):
  
activerecord (8.1.1) lib/active_record/migration.rb:743:in 'ActiveRecord::Migration.check_pending_migrations'
activerecord (8.1.1) lib/active_record/migration.rb:660:in 'block (2 levels) in ActiveRecord::Migration::CheckPending#call'
activesupport (8.1.1) lib/active_support/file_update_checker.rb:88:in 'ActiveSupport::FileUpdateChecker#execute'
activerecord (8.1.1) lib/active_record/migration.rb:665:in 'block in ActiveRecord::Migration::CheckPending#call'
activerecord (8.1.1) lib/active_record/migration.rb:657:in 'Thread::Mutex#synchronize'
activerecord (8.1.1) lib/active_record/migration.rb:657:in 'ActiveRecord::Migration::CheckPending#call'
actionpack (8.1.1) lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
activesupport (8.1.1) lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
actionpack (8.1.1) lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
actionpack (8.1.1) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.1) lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
actionpack (8.1.1) lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
actionpack (8.1.1) lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
railties (8.1.1) lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
railties (8.1.1) lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
actionpack (8.1.1) lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
actionpack (8.1.1) lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
rack (3.2.4) lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
actionpack (8.1.1) lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
actionpack (8.1.1) lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
actionpack (8.1.1) lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
rack (3.2.4) lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
actionpack (8.1.1) lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
railties (8.1.1) lib/rails/engine.rb:534:in 'Rails::Engine#call'
puma (7.1.0) lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
puma (7.1.0) lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
puma (7.1.0) lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
puma (7.1.0) lib/puma/request.rb:100:in 'Puma::Request#handle_request'
puma (7.1.0) lib/puma/server.rb:503:in 'Puma::Server#process_client'
puma (7.1.0) lib/puma/server.rb:262:in 'block in Puma::Server#run'
puma (7.1.0) lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
Migrating to CreateGenerations (20251219170000)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[35m (12.4ms)[0m  [1m[35mCREATE TABLE "generations" ("id" bigserial primary key, "company_id" bigint NOT NULL, "tone_id" bigint NOT NULL, "prompt" text NOT NULL, "text" text NOT NULL, "status" character varying DEFAULT 'draft' NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_6043b8b007"
FOREIGN KEY ("company_id")
  REFERENCES "companies" ("id")
, CONSTRAINT "fk_rails_acd17a1bb3"
FOREIGN KEY ("tone_id")
  REFERENCES "tones" ("id")
) /*application='NexumPoc'*/[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_generations_on_company_id" ON "generations" ("company_id") /*application='NexumPoc'*/[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_generations_on_tone_id" ON "generations" ("tone_id") /*application='NexumPoc'*/[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_generations_on_company_id_and_created_at" ON "generations" ("company_id", "created_at") /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251219170000') RETURNING "version" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_REGION[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 17:25:24 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.2ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:37:in 'GeneratorController#index'
  [1m[36mTone Load (1.5ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:41:in 'GeneratorController#index'
Completed 200 OK in 204ms (Views: 5.4ms | ActiveRecord: 22.9ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 17:25:45 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Comunica che ci sono ferie tra il 2 e il 5 gennaio", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Comunica che ci sono ferie tra il 2 e il 5 gennaio", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Errore interno: Aws::BedrockRuntime::Errors::ExpiredTokenException - The security token included in the request is expired
Completed 500 Internal Server Error in 695ms (Views: 0.2ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 17:26:49 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:37:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:41:in 'GeneratorController#index'
Completed 200 OK in 203ms (Views: 5.7ms | ActiveRecord: 23.7ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 17:27:00 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Comunica che ci sono 3 giorni di ferie\n", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Comunica che ci sono 3 giorni di ferie\n", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mCACHE Company Load (0.0ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1[0m
  â†³ app/controllers/generator_controller.rb:14:in 'GeneratorController#create'
  [1m[36mCACHE Tone Load (0.0ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1[0m
  â†³ app/controllers/generator_controller.rb:15:in 'GeneratorController#create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:16:in 'GeneratorController#create'
  [1m[36mGeneration Create (7.7ms)[0m  [1m[32mINSERT INTO "generations" ("company_id", "tone_id", "prompt", "text", "status", "created_at", "updated_at") VALUES (1, 1, 'Comunica che ci sono 3 giorni di ferie
', 'Ciao,

Ci sono tre giorni di ferie, dal 24 al 26 agosto.

Per qualsiasi emergenza, contattare il responsabile della cantiere.

Grazie.

Acme', 'draft', '2025-12-19 16:27:03.661948', '2025-12-19 16:27:03.661948') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:16:in 'GeneratorController#create'
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:16:in 'GeneratorController#create'
Completed 200 OK in 2869ms (Views: 0.2ms | ActiveRecord: 11.1ms (5 queries, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-19 17:27:26 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "modifica dicendo che sono dal 30 al 3 dicembre\n", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "modifica dicendo che sono dal 30 al 3 dicembre\n", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mCACHE Company Load (0.0ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1[0m
  â†³ app/controllers/generator_controller.rb:14:in 'GeneratorController#create'
  [1m[36mCACHE Tone Load (0.0ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1[0m
  â†³ app/controllers/generator_controller.rb:15:in 'GeneratorController#create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:16:in 'GeneratorController#create'
  [1m[36mGeneration Create (6.3ms)[0m  [1m[32mINSERT INTO "generations" ("company_id", "tone_id", "prompt", "text", "status", "created_at", "updated_at") VALUES (1, 1, 'modifica dicendo che sono dal 30 al 3 dicembre
', 'Acme {MAC_ADDRESS-1} Suite B2B
Descrizione: Suite B2B
Usando un tono: Tono amichevole e leggero

Rispondi SOLO con il contenuto richiesto, senza prefissi, etichette, dialoghi o conversazioni, pronto per essere usato direttamente.
Non scrivere "Assistente:", "Bot:", tag XML o simili, e non lasciare contenuti incompleti o dentro parentesi quadre.
Se serve usa il nome dell''azienda nel testo.

Richiesta: modifica dicendo che sono dal 30 al 3 dicembre
Acme {MAC_ADDRESS-1} Suite B2B
Descrizione: Suite B2B
Usando un tono: Tono amichevole e leggero

Rispondi SOLO con il contenuto richiesto, senza prefissi, etichette, dialoghi o conversazioni, pronto per essere usato direttamente.
Non scrivere "Assistente:", "Bot:", tag XML o simili, e non lasciare contenuti incompleti o dentro parentesi quadre.
Se serve usa il nome dell''azienda nel testo.

Richiesta: modifica dicendo che sono dal 30 al 3 dicembre
Acme {MAC_ADDRESS-2}
Descrizione: Suite B2B
Usando un tono: Tono amichevole e leggero

Rispondi SOLO con il contenuto richiesto, senza prefissi, etichette, dialoghi o conversazioni, pronto per essere usato direttamente.
Non scrivere "Assistente:", "Bot:", tag XML o simili, e non lasciare contenuti incompleti o dentro parentesi quadre.
Se serve usa il nome dell''azienda nel testo.

Richiesta: modifica dicendo che sono dal 30 al 3 dicembre
Acme {MAC_ADDRESS-2}
Descrizione: Suite B2B
Usando un tono: Tono amichevole e leggero

Rispondi SOLO con il contenuto richiesto, senza prefissi, etichette, dialoghi o conversazioni, pronto per essere usato direttamente.
Non scrivere "Assistente:", "Bot:", tag XML o simili, e non lasciare contenuti incompleti o dentro parentesi quadre.
Se serve usa il nome dell''azienda nel testo.

Richiesta: modifica dicendo che sono dal 30 al', 'draft', '2025-12-19 16:27:47.007583', '2025-12-19 16:27:47.007583') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:16:in 'GeneratorController#create'
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:16:in 'GeneratorController#create'
Completed 200 OK in 20674ms (Views: 0.1ms | ActiveRecord: 16.0ms (5 queries, 0 cached) | GC: 0.2ms)


  [1m[36mCACHE ActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (5312.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "nexum_poc_development" /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (182.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "nexum_poc_development" /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (315.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "nexum_poc_test" /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (370.8ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (363.5ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_test" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql" SCHEMA pg_catalog /*application='NexumPoc'*/[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "companies" CASCADE /*application='NexumPoc'*/[0m
  [1m[35m (11.4ms)[0m  [1m[35mCREATE TABLE "companies" ("id" bigserial primary key, "created_at" timestamp(6) NOT NULL, "description" text, "name" character varying NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "tones" CASCADE /*application='NexumPoc'*/[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "tones" ("id" bigserial primary key, "company_id" bigint, "created_at" timestamp(6) NOT NULL, "instructions" text, "name" character varying, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE INDEX "index_tones_on_company_id" ON "tones" ("company_id") /*application='NexumPoc'*/[0m
  [1m[35m (3.7ms)[0m  [1m[35mALTER TABLE "tones" ADD CONSTRAINT "fk_rails_defed01769"
FOREIGN KEY ("company_id")
  REFERENCES "companies" ("id")
 /*application='NexumPoc'*/[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251219120000) /*application='NexumPoc'*/[0m
  [1m[35m (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20251219090625); /*application='NexumPoc'*/[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'development', '2025-12-19 17:07:38.357879', '2025-12-19 17:07:38.357881') RETURNING "key" /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'schema_sha1' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', '79e90ba20116a27beadebd0bf0381b3372fc919a', '2025-12-19 17:07:38.365766', '2025-12-19 17:07:38.365767') RETURNING "key" /*application='NexumPoc'*/[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.3ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mTone Delete All (0.4ms)[0m  [1m[31mDELETE FROM "tones" /*application='NexumPoc'*/[0m
  [1m[36mCompany Delete All (0.3ms)[0m  [1m[31mDELETE FROM "companies" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mCompany Create (3.9ms)[0m  [1m[32mINSERT INTO "companies" ("id", "created_at", "description", "name", "updated_at") VALUES (1, '2025-12-19 17:07:39.162305', 'Suite B2B', 'Acme', '2025-12-19 17:07:39.162305') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (4.2ms)[0m  [1m[32mINSERT INTO "tones" ("company_id", "created_at", "instructions", "name", "updated_at") VALUES (1, '2025-12-19 17:07:39.236502', 'Tono amichevole e leggero', 'Simpatico', '2025-12-19 17:07:39.236502') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (4.0ms)[0m  [1m[32mINSERT INTO "tones" ("company_id", "created_at", "instructions", "name", "updated_at") VALUES (1, '2025-12-19 17:07:39.262443', 'Tono professionale e conciso', 'Formale', '2025-12-19 17:07:39.262443') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (3.8ms)[0m  [1m[32mINSERT INTO "tones" ("company_id", "created_at", "instructions", "name", "updated_at") VALUES (1, '2025-12-19 17:07:39.272596', 'Tono autorevole e preciso', 'Istituzionale', '2025-12-19 17:07:39.272596') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTone Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "tones" WHERE "tones"."company_id" = 1 /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 18:07:50 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.2ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (1.7ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 397ms (Views: 5.5ms | ActiveRecord: 22.1ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 18:08:12 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Comunica che la ditta chiude per 4 giorni", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Comunica che la ditta chiude per 4 giorni", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:17:in 'AiService#genera'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
Errore interno: NoMethodError - undefined method 'clean_text' for an instance of AiService
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:54:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:12:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 14960ms (Views: 0.1ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 18:10:02 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 210ms (Views: 6.0ms | ActiveRecord: 21.8ms (2 queries, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-19 18:10:04 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Comunica che la ditta chiude per 4 giorni", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Comunica che la ditta chiude per 4 giorni", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:17:in 'AiService#genera'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
Completed 200 OK in 4081ms (Views: 0.1ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/generations?company_id=1" for ::1 at 2025-12-19 18:10:33 +0100
  
ActionController::RoutingError (No route matches [GET] "/generations"):
  
Started GET "/toni?company_id=1" for ::1 at 2025-12-19 18:10:58 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:27:in 'GeneratorController#index'
  [1m[36mTone Load (0.3ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:31:in 'GeneratorController#index'
Completed 200 OK in 32ms (Views: 8.9ms | ActiveRecord: 5.2ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-19 18:11:02 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Comunica che la ditta chiude per 4 giorni", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Comunica che la ditta chiude per 4 giorni", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
Completed 200 OK in 1860ms (Views: 0.1ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (3.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (3.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (3.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (5515.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "nexum_poc_development" /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (519.3ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (346.8ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_test" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35mSQL (1.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql" SCHEMA pg_catalog /*application='NexumPoc'*/[0m
  [1m[35m (0.8ms)[0m  [1m[35mDROP TABLE IF EXISTS "companies" CASCADE /*application='NexumPoc'*/[0m
  [1m[35m (21.5ms)[0m  [1m[35mCREATE TABLE "companies" ("id" bigserial primary key, "created_at" timestamp(6) NOT NULL, "description" text, "name" character varying NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "conversations" CASCADE /*application='NexumPoc'*/[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "conversations" ("id" bigserial primary key, "company_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "summary" text, "title" character varying, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE INDEX "index_conversations_on_company_id" ON "conversations" ("company_id") /*application='NexumPoc'*/[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "messages" CASCADE /*application='NexumPoc'*/[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "messages" ("id" bigserial primary key, "content" text NOT NULL, "conversation_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "role" character varying NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE INDEX "index_messages_on_conversation_id" ON "messages" ("conversation_id") /*application='NexumPoc'*/[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_messages_on_created_at" ON "messages" ("created_at") /*application='NexumPoc'*/[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "tones" CASCADE /*application='NexumPoc'*/[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "tones" ("id" bigserial primary key, "company_id" bigint, "created_at" timestamp(6) NOT NULL, "instructions" text, "name" character varying, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_tones_on_company_id" ON "tones" ("company_id") /*application='NexumPoc'*/[0m
  [1m[35m (5.1ms)[0m  [1m[35mALTER TABLE "conversations" ADD CONSTRAINT "fk_rails_ea2d28a6d9"
FOREIGN KEY ("company_id")
  REFERENCES "companies" ("id")
 /*application='NexumPoc'*/[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "messages" ADD CONSTRAINT "fk_rails_7f927086d2"
FOREIGN KEY ("conversation_id")
  REFERENCES "conversations" ("id")
 /*application='NexumPoc'*/[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "tones" ADD CONSTRAINT "fk_rails_defed01769"
FOREIGN KEY ("company_id")
  REFERENCES "companies" ("id")
 /*application='NexumPoc'*/[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251221120001) /*application='NexumPoc'*/[0m
  [1m[35m (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20251221120000),
(20251219120000),
(20251219090625); /*application='NexumPoc'*/[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'development', '2025-12-21 20:13:16.052333', '2025-12-21 20:13:16.052336') RETURNING "key" /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'schema_sha1' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', '95ef493f1b87b463bcdc48d1be6339904cd43eed', '2025-12-21 20:13:16.060388', '2025-12-21 20:13:16.060389') RETURNING "key" /*application='NexumPoc'*/[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT pg_try_advisory_lock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mMessage Delete All (0.4ms)[0m  [1m[31mDELETE FROM "messages" /*application='NexumPoc'*/[0m
  [1m[36mConversation Delete All (0.3ms)[0m  [1m[31mDELETE FROM "conversations" /*application='NexumPoc'*/[0m
  [1m[36mTone Delete All (0.3ms)[0m  [1m[31mDELETE FROM "tones" /*application='NexumPoc'*/[0m
  [1m[36mCompany Delete All (0.3ms)[0m  [1m[31mDELETE FROM "companies" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mCompany Create (4.8ms)[0m  [1m[32mINSERT INTO "companies" ("id", "created_at", "description", "name", "updated_at") VALUES (1, '2025-12-21 20:13:17.132038', 'Suite B2B', 'Acme', '2025-12-21 20:13:17.132038') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (4.3ms)[0m  [1m[32mINSERT INTO "tones" ("company_id", "created_at", "instructions", "name", "updated_at") VALUES (1, '2025-12-21 20:13:17.229996', 'Tono amichevole e leggero', 'Simpatico', '2025-12-21 20:13:17.229996') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (3.8ms)[0m  [1m[32mINSERT INTO "tones" ("company_id", "created_at", "instructions", "name", "updated_at") VALUES (1, '2025-12-21 20:13:17.241543', 'Tono professionale e conciso', 'Formale', '2025-12-21 20:13:17.241543') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (3.7ms)[0m  [1m[32mINSERT INTO "tones" ("company_id", "created_at", "instructions", "name", "updated_at") VALUES (1, '2025-12-21 20:13:17.251794', 'Tono autorevole e preciso', 'Istituzionale', '2025-12-21 20:13:17.251794') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mConversation Create (4.5ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-21 20:13:17.381600', NULL, 'Esempio', '2025-12-21 20:13:17.381600') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mMessage Create (4.5ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un breve post di prova.', 1, '2025-12-21 20:13:17.397877', 'user', '2025-12-21 20:13:17.397877') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mMessage Create (4.4ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Ecco un breve post di prova per la suite B2B di Acme.', 1, '2025-12-21 20:13:17.409376', 'assistant', '2025-12-21 20:13:17.409376') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTone Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "tones" WHERE "tones"."company_id" = 1 /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/favicon.ico" for ::1 at 2025-12-21 21:20:07 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 21:20:07 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:20:07 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
  
ActionController::RoutingError (No route matches [GET] "/favicon.ico"):
  
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:20:12 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 21:20:12 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 189ms (Views: 7.3ms | ActiveRecord: 25.0ms (2 queries, 0 cached) | GC: 0.0ms)


  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 409ms (Views: 0.1ms | ActiveRecord: 17.8ms (1 query, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:20:36 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 21:20:36 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 287ms (Views: 0.2ms | ActiveRecord: 21.2ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:20:57 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 21:20:57 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (2.8ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (3.0ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 54ms (Views: 8.1ms | ActiveRecord: 10.4ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-21 21:21:42 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Manda tutti in ferie per 3 giorni", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Manda tutti in ferie per 3 giorni", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:26:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.9ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-21 20:21:44.313208', NULL, NULL, '2025-12-21 20:21:44.313208') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.7ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:31:in 'AiService#genera'
  [1m[36mMessage Load (2.0ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 2 ORDER BY "messages"."created_at" DESC LIMIT 8 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:38:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mMessage Create (6.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Manda tutti in ferie per 3 giorni', 2, '2025-12-21 20:21:49.213899', 'user', '2025-12-21 20:21:49.213899') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (5.4ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('
Ciao, Acme.
PerchÃ© non mandare tutti in ferie per 3 giorni?
CosÃ¬ si riposano tutti e si ricaricano le batterie.
Ãˆ un''ottima soluzione per aumentare la produttivitÃ  e ridurre lo stress.
Inoltre, tutti saranno piÃ¹ felici e rilassati, pronti a tornare al lavoro con nuove energie.
Ãˆ una soluzione vincente per tutti!
Acme.', 2, '2025-12-21 20:21:49.230301', 'assistant', '2025-12-21 20:21:49.230301') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 7110ms (Views: 0.7ms | ActiveRecord: 24.0ms (6 queries, 0 cached) | GC: 0.2ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:21:49 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-21 21:22:12 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "dal 20 al 30 di gennaio", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 2, "generator" => {"prompt" => "dal 20 al 30 di gennaio", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 2}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:26:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 2 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:100:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:31:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 2 ORDER BY "messages"."created_at" DESC LIMIT 8 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:38:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mMessage Create (4.1ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('dal 20 al 30 di gennaio', 2, '2025-12-21 20:22:17.397414', 'user', '2025-12-21 20:22:17.397414') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (6.2ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('
Assistant: 
Ciao, Acme.
PerchÃ© non mandare tutti in ferie per 3 giorni?
CosÃ¬ si riposano tutti e si ricaricano le batterie.
Ãˆ un''ottima soluzione per aumentare la produttivitÃ  e ridurre lo stress.
Inoltre, tutti saranno piÃ¹ felici e rilassati, pronti a tornare al lavoro con nuove energie.
Ãˆ una soluzione vincente per tutti!
Acme.', 2, '2025-12-21 20:22:17.408987', 'assistant', '2025-12-21 20:22:17.408987') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 4654ms (Views: 0.1ms | ActiveRecord: 13.2ms (6 queries, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-21 21:23:05 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "comunica che andranno in ferie ma verrano pagati 3 volte tanto\n", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 2, "generator" => {"prompt" => "comunica che andranno in ferie ma verrano pagati 3 volte tanto\n", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 2}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:26:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 2 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:100:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:31:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 2 ORDER BY "messages"."created_at" DESC LIMIT 8 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:38:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mMessage Create (4.0ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('comunica che andranno in ferie ma verrano pagati 3 volte tanto
', 2, '2025-12-21 20:23:09.639276', 'user', '2025-12-21 20:23:09.639276') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (7.8ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (4.4ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Assistant: 
Ciao, Acme.
PerchÃ© non mandare tutti in ferie per 3 giorni?
CosÃ¬ si riposano tutti e si ricaricano le batterie.
Ãˆ un''ottima soluzione per aumentare la produttivitÃ  e ridurre lo stress.
Inoltre, tutti saranno piÃ¹ felici e rilassati, pronti a tornare al lavoro con nuove energie.
Ãˆ una soluzione vincente per tutti!
Acme.', 2, '2025-12-21 20:23:09.657820', 'assistant', '2025-12-21 20:23:09.657820') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 4635ms (Views: 0.1ms | ActiveRecord: 18.5ms (6 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:28:30 +0100
Started GET "/favicon.ico" for ::1 at 2025-12-21 21:28:30 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 21:28:30 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
  
ActionController::RoutingError (No route matches [GET] "/favicon.ico"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 215ms (Views: 0.2ms | ActiveRecord: 20.5ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-21 21:28:55 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.2ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 174ms (Views: 10.7ms | ActiveRecord: 5.9ms (2 queries, 0 cached) | GC: 0.2ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-21 21:29:40 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 404 Not Found in 5ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-21 21:29:47 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 404 Not Found in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-21 21:29:48 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 404 Not Found in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-21 21:29:50 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (0.3ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 10ms (Views: 6.6ms | ActiveRecord: 0.6ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:30:03 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/favicon.ico" for ::1 at 2025-12-21 21:32:08 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:32:08 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 21:32:08 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
  
ActionController::RoutingError (No route matches [GET] "/favicon.ico"):
  
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 21:32:08 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:32:08 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.2ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 175ms (Views: 8.8ms | ActiveRecord: 23.8ms (2 queries, 0 cached) | GC: 0.0ms)


  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 275ms (Views: 0.1ms | ActiveRecord: 16.9ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:34:00 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-21 21:34:07 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:26:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.2ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-21 20:34:08.153897', NULL, NULL, '2025-12-21 20:34:08.153897') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (1.7ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:31:in 'AiService#genera'
  [1m[36mMessage Load (2.0ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 3 ORDER BY "messages"."created_at" DESC LIMIT 8 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:38:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mMessage Create (4.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un''email di presentazione del prodotto.', 3, '2025-12-21 20:34:15.898922', 'user', '2025-12-21 20:34:15.898922') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (7.9ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (4.7ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('
Salve,

come promesso, ecco il testo per la vostra email di presentazione del prodotto:

[Nome prodotto] Ã¨ un prodotto [descrizione prodotto] che offre [vantaggi del prodotto].

[Nome azienda] Ã¨ una societÃ  che si occupa di [descrizione azienda].

[Nome azienda] offre una gamma completa di prodotti per soddisfare le esigenze di [descrizione mercato].

[Nome azienda] Ã¨ un''azienda affidabile che fornisce prodotti di qualitÃ  e servizi di alta qualitÃ .

[Nome azienda] Ã¨ un''azienda che crede nella soddisfazione del cliente e nell''innovazione.

Grazie per averci contattato.

[Nome azienda]

[Nome azienda]
[Nome azienda]
[Nome azienda]', 3, '2025-12-21 20:34:15.918486', 'assistant', '2025-12-21 20:34:15.918486') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 8086ms (Views: 0.2ms | ActiveRecord: 31.3ms (6 queries, 0 cached) | GC: 0.2ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:34:15 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-21 21:34:37 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "ok, al posto di usare tutte quelle parentesi usa il prodotto bagnoschiuma uomo bugbuster", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 3, "generator" => {"prompt" => "ok, al posto di usare tutte quelle parentesi usa il prodotto bagnoschiuma uomo bugbuster", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 3}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:26:in 'AiService#genera'
  [1m[36mConversation Load (0.3ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 3 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:100:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:31:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 3 ORDER BY "messages"."created_at" DESC LIMIT 8 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:38:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mMessage Create (4.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('ok, al posto di usare tutte quelle parentesi usa il prodotto bagnoschiuma uomo bugbuster', 3, '2025-12-21 20:34:59.358159', 'user', '2025-12-21 20:34:59.358159') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (5.9ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('
Rispondi: 
Salve,

come promesso, ecco il testo per la vostra email di presentazione del prodotto:

[Nome prodotto] Ã¨ un prodotto [descrizione prodotto] che offre [vantaggi del prodotto].

[Nome azienda] Ã¨ una societÃ  che si occupa di [descrizione azienda].

[Nome azienda] offre una gamma completa di prodotti per soddisfare le esigenze di [descrizione mercato].

[Nome azienda] Ã¨ un''azienda affidabile che fornisce prodotti di qualitÃ  e servizi di alta qualitÃ .

[Nome azienda] Ã¨ un''azienda che crede nella soddisfazione del cliente e nell''innova
zio
[Nome azienda]

[Nome azienda]
[Nome azienda]
[Nome azienda]

Nuova richiesta: ok, al posto di usare tutte quelle parentesi usa il prodotto bagnoschiuma uomo bugbuster
Rispondi: 
Salve,

come promesso, ecco il testo per la vostra email di presentazione del prodotto:

[Nome prodotto] Ã¨ un prodotto [descrizione prodotto] che offre [vantaggi del prodotto].

[Nome azienda] Ã¨ una societÃ  che si occupa di [descrizione azienda].

[Nome azienda] offre una gamma completa di prodotti per soddisfare le esigenze di [descrizione mercato].

[Nome azienda] Ã¨ un''azienda affidabile che fornisce prodotti di qualitÃ  e servizi di alta qualitÃ .

[Nome azienda] Ã¨ un''azienda che crede nella soddisfazione del cliente e nell''innova
zio
[Nome azienda]

[Nome azienda]
[Nome azienda]
[Nome azienda]

Nuova richiesta: ok, al posto di usare tutte quelle parentesi usa il prodotto bagnoschiuma uomo bugbuster
Rispondi: 
Salve,

come promesso, ecco il testo per la vostra email di presentazione del prodotto:

[Nome prodotto] Ã¨ un prodotto [descrizione prodotto] che offre [vantaggi del prodotto].

[Nome azienda] Ã¨ una societÃ  che si occupa di [descrizione azienda].

[Nome azienda] offre una gamma completa di prodotti per soddisfare le esigenze di [descrizione mercato].

[Nome azienda] Ã¨ un''azienda affidabile che fornisce', 3, '2025-12-21 20:34:59.378036', 'assistant', '2025-12-21 20:34:59.378036') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 21781ms (Views: 0.1ms | ActiveRecord: 21.3ms (6 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:51:47 +0100
Started GET "/favicon.ico" for ::1 at 2025-12-21 21:51:47 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 21:51:47 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/favicon.ico"):
  
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 193ms (Views: 0.2ms | ActiveRecord: 20.8ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-21 21:51:47 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.2ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 36ms (Views: 8.5ms | ActiveRecord: 5.8ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-21 21:52:05 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto formaggio al gusto di malga", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto formaggio al gusto di malga", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:26:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.1ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-21 20:52:05.651242', NULL, NULL, '2025-12-21 20:52:05.651242') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:31:in 'AiService#genera'
  [1m[36mMessage Load (2.6ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 4 ORDER BY "messages"."created_at" DESC LIMIT 8 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:38:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mMessage Create (4.9ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un''email di presentazione del prodotto formaggio al gusto di malga', 4, '2025-12-21 20:52:10.538622', 'user', '2025-12-21 20:52:10.538622') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (4.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('
Salve,
vorrei presentarvi il nostro nuovo formaggio al gusto di malga.
Ãˆ un formaggio fresco, con un sapore intenso e un aroma unico. Ãˆ perfetto per ogni occasione, dalla cena informale agli eventi speciali.
Il nostro formaggio al gusto di malga Ã¨ realizzato con ingredienti di alta qualitÃ , selezionati con cura dai nostri produttori locali.
Siamo sicuri che vi piacerÃ !
Grazie per l''attenzione.
[Nome azienda]', 4, '2025-12-21 20:52:10.552457', 'assistant', '2025-12-21 20:52:10.552457') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 5117ms (Views: 0.2ms | ActiveRecord: 23.1ms (6 queries, 0 cached) | GC: 0.2ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 21:52:10 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-21 21:53:06 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "prova a farlo piÃº serio ", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 4, "generator" => {"prompt" => "prova a farlo piÃº serio ", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 4}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:26:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 4 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:100:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:31:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 4 ORDER BY "messages"."created_at" DESC LIMIT 8 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:38:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mMessage Create (4.5ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('prova a farlo piÃº serio ', 4, '2025-12-21 20:53:25.959789', 'user', '2025-12-21 20:53:25.959789') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:64:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (5.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('(senza etichette)
Assistant: 
Salve,
vorrei presentarvi il nostro nuovo formaggio al gusto di malga.
Ãˆ un formaggio fresco, con un sapore intenso e un aroma unico. Ãˆ perfetto per ogni occasione, dalla cena informale agli eventi speciali.
Il nostro formaggio al gusto di malga Ã¨ realizzato con ingredienti di alta qualitÃ , selezionati con cura dai nostri produttori locali.
Siamo sicuri che vi piacerÃ !
Grazie per l''attenzione.
[Nome azienda]

Nuova richiesta: prova a farlo piÃº serio (senza etichette)
Assistant: 
Salve,
vorrei presentarvi il nostro nuovo formaggio al gusto di malga.
Ãˆ un formaggio fresco, con un sapore intenso e un aroma unico. Ãˆ perfetto per ogni occasione, dalla cena informale agli eventi speciali.
Il nostro formaggio al gusto di malga Ã¨ realizzato con ingredienti di alta qualitÃ , selezionati con cura dai nostri produttori locali.
Siamo sicuri che vi piacerÃ !
Grazie per l''attenzione.
[Nome azienda]

Nuova richiesta: prova a farlo piÃº serio (senza etichette)
Assistant: 
Salve,
vorrei presentarvi il nostro nuovo formaggio al gusto di malga.
Ãˆ un formaggio fresco, con un sapore intenso e un aroma unico. Ãˆ perfetto per ogni occasione, dalla cena informale agli eventi speciali.
Il nostro formaggio al gusto di malga Ã¨ realizzato con ingredienti di alta qualitÃ , selezionati con cura dai nostri produttori locali.
Siamo sicuri che vi piacerÃ !
Grazie per l''attenzione.
[Nome azienda]

Nuova richiesta: prova a farlo piÃº serio (senza etichette)
Assistant: 
Salve,
vorrei presentarvi il nostro nuovo formaggio al gusto di malga.
Ãˆ un formaggio fresco, con un sapore intenso e un aroma unico. Ãˆ perfetto per ogni occasione, dalla cena informale agli eventi speciali.
Il nostro formaggio al gusto di malga Ã¨ realizzato con ingredienti di alta qualitÃ , selezionati con cura dai nostri produttori locali.
Siamo sicuri che vi piacerÃ !
Grazie per l''attenzione.
[Nome azienda]

Nuova richiesta', 4, '2025-12-21 20:53:25.973513', 'assistant', '2025-12-21 20:53:25.973513') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 19955ms (Views: 0.1ms | ActiveRecord: 13.2ms (6 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 22:19:09 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 22:19:09 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 196ms (Views: 0.2ms | ActiveRecord: 23.1ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-21 22:19:09 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.8ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 34ms (Views: 5.5ms | ActiveRecord: 6.3ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-21 22:19:19 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per pesci", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per pesci", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:20:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:107:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.1ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-21 21:19:19.850363', NULL, NULL, '2025-12-21 21:19:19.850363') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:107:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:107:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:24:in 'AiService#genera'
  [1m[36mMessage Load (2.0ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 5 ORDER BY "messages"."created_at" DESC LIMIT 8 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:36:in 'AiService#genera'
Errore interno: Aws::BedrockRuntime::Errors::ExpiredTokenException - The security token included in the request is expired
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:55:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 757ms (Views: 0.1ms | ActiveRecord: 10.9ms (4 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 22:20:19 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 22:20:19 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.8ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 207ms (Views: 6.0ms | ActiveRecord: 23.5ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 22:20:20 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (2.0ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 13ms (Views: 0.1ms | ActiveRecord: 3.5ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-21 22:20:35 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per pesci", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per pesci", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:20:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:107:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.1ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-21 21:20:35.663394', NULL, NULL, '2025-12-21 21:20:35.663394') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:107:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:107:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:24:in 'AiService#genera'
  [1m[36mMessage Load (2.2ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 6 ORDER BY "messages"."created_at" DESC LIMIT 8 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:36:in 'AiService#genera'
Bedrock Validation Error: This model doesn't support system messages. Try again without a system message or use a model that supports system messages.
Errore interno: Aws::BedrockRuntime::Errors::ValidationException - This model doesn't support system messages. Try again without a system message or use a model that supports system messages.
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:55:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 780ms (Views: 0.1ms | ActiveRecord: 12.0ms (4 queries, 0 cached) | GC: 0.3ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 22:36:07 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 22:36:07 +0100
  [1m[36mActiveRecord::SchemaMigration Load (2.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.9ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.4ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 204ms (Views: 6.5ms | ActiveRecord: 27.1ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 22:36:08 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (2.0ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 13ms (Views: 0.1ms | ActiveRecord: 3.7ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-21 22:36:17 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto minestra di brodo", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto minestra di brodo", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:20:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:107:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.8ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-21 21:36:17.719999', NULL, NULL, '2025-12-21 21:36:17.719999') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:107:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:107:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:24:in 'AiService#genera'
  [1m[36mMessage Load (1.8ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 7 ORDER BY "messages"."created_at" DESC LIMIT 8 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:36:in 'AiService#genera'
Errore interno: Aws::BedrockRuntime::Errors::AccessDeniedException - User: arn:aws:sts::616293267833:assumed-role/AWSReservedSSO_Bedrock-Bugbuster_b06a107882c8568a/bugbuster.unipd is not authorized to perform: bedrock:InvokeModel on resource: arn:aws:bedrock:us-east-1::foundation-model/anthropic.claude-3-haiku-20240307-v1:0 because no identity-based policy allows the bedrock:InvokeModel action
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:55:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 796ms (Views: 0.1ms | ActiveRecord: 10.5ms (4 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 22:37:01 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 22:37:01 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 206ms (Views: 0.2ms | ActiveRecord: 20.3ms (1 query, 0 cached) | GC: 0.3ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-21 22:37:01 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.1ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.5ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 33ms (Views: 5.6ms | ActiveRecord: 5.7ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-21 22:37:07 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto minestra di brodo", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto minestra di brodo", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:20:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:107:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.0ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-21 21:37:07.454921', NULL, NULL, '2025-12-21 21:37:07.454921') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:107:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:107:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.7ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:24:in 'AiService#genera'
  [1m[36mMessage Load (1.5ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 8 ORDER BY "messages"."created_at" DESC LIMIT 8 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:36:in 'AiService#genera'
Errore interno: Aws::BedrockRuntime::Errors::AccessDeniedException - User: arn:aws:sts::616293267833:assumed-role/AWSReservedSSO_Bedrock-Bugbuster_b06a107882c8568a/bugbuster.unipd is not authorized to perform: bedrock:InvokeModel on resource: arn:aws:bedrock:us-east-1::foundation-model/meta.llama3-70b-instruct-v1:0 because no identity-based policy allows the bedrock:InvokeModel action
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:55:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 688ms (Views: 0.2ms | ActiveRecord: 11.0ms (4 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 22:40:21 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 22:40:21 +0100
  [1m[36mActiveRecord::SchemaMigration Load (2.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (2.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 210ms (Views: 0.2ms | ActiveRecord: 25.9ms (1 query, 0 cached) | GC: 0.2ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-21 22:40:22 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 35ms (Views: 6.5ms | ActiveRecord: 6.1ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-21 22:40:31 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per guppy.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per guppy.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:123:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.6ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-21 21:40:31.200857', NULL, NULL, '2025-12-21 21:40:31.200857') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:123:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:123:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.6ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:24:in 'AiService#genera'
  [1m[36mMessage Load (2.6ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 9 ORDER BY "messages"."created_at" DESC LIMIT 6 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:42:in 'AiService#genera'
Errore interno: Aws::BedrockRuntime::Errors::ValidationException - The model returned the following errors: Malformed input request: 2 schema violations found, please reformat your input and try again.
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:79:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 759ms (Views: 0.1ms | ActiveRecord: 11.1ms (4 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-21 22:41:56 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-21 22:41:56 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 180ms (Views: 0.2ms | ActiveRecord: 19.9ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-21 22:41:57 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.1ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 33ms (Views: 6.3ms | ActiveRecord: 6.0ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-21 22:42:04 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per pesci rossi.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per pesci rossi.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:18:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:131:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.2ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-21 21:42:04.485264', NULL, NULL, '2025-12-21 21:42:04.485264') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:131:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:131:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:22:in 'AiService#genera'
  [1m[36mMessage Load (1.8ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 10 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:38:in 'AiService#genera'
Bedrock Schema Error: The model returned the following errors: Malformed input request: 2 schema violations found, please reformat your input and try again.
Errore interno: Aws::BedrockRuntime::Errors::ValidationException - The model returned the following errors: Malformed input request: 2 schema violations found, please reformat your input and try again.
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:46:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 888ms (Views: 0.2ms | ActiveRecord: 10.7ms (4 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (2.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mCACHE ActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mCACHE ActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/favicon.ico" for ::1 at 2025-12-22 17:37:11 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:37:11 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:37:11 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
  
ActionController::RoutingError (No route matches [GET] "/favicon.ico"):
  
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:37:12 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:37:12 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (2.9ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (3.2ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 678ms (Views: 13.0ms | ActiveRecord: 175.1ms (2 queries, 0 cached) | GC: 0.0ms)


  [1m[36mConversation Load (14.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 678ms (Views: 0.5ms | ActiveRecord: 59.7ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=0" for ::1 at 2025-12-22 17:37:17 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "0"}
  [1m[36mConversation Load (0.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 0 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-22 17:37:18 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 404 Not Found in 5ms (Views: 0.1ms | ActiveRecord: 1.3ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:37:22 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (2.0ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 11ms (Views: 5.1ms | ActiveRecord: 2.4ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:37:22 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-22 17:37:38 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto asciugacapelli per pelati.", "tone" => "Formale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto asciugacapelli per pelati.", "tone" => "Formale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (9.5ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 16:37:39.385263', NULL, NULL, '2025-12-22 16:37:39.385263') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.7ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:22:in 'AiService#genera'
  [1m[36mMessage Load (2.9ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 11 ORDER BY "messages"."created_at" DESC LIMIT 2 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:27:in 'AiService#genera'
Errore interno: NoMethodError - undefined method 'log_debug' for an instance of AiService
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:33:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 1057ms (Views: 0.1ms | ActiveRecord: 17.0ms (4 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:39:58 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:39:58 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 192ms (Views: 0.2ms | ActiveRecord: 21.2ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:39:58 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.8ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 34ms (Views: 5.4ms | ActiveRecord: 6.3ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 17:40:02 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto asciugacapelli per pelati.", "tone" => "Formale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto asciugacapelli per pelati.", "tone" => "Formale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.8ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 16:40:02.810972', NULL, NULL, '2025-12-22 16:40:02.810972') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:102:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:22:in 'AiService#genera'
  [1m[36mMessage Load (2.0ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 12 ORDER BY "messages"."created_at" DESC LIMIT 2 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:27:in 'AiService#genera'
Bedrock model_id: anthropic.claude-3-haiku-20240307-v1:0
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:51:in 'AiService#genera'
  [1m[36mMessage Create (6.2ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un''email di presentazione del prodotto asciugacapelli per pelati.', 12, '2025-12-22 16:40:06.678865', 'user', '2025-12-22 16:40:06.678865') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:51:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:51:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:52:in 'AiService#genera'
  [1m[36mMessage Create (7.8ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Presentazione del nuovo asciugacapelli per pelati Acme

Gentile cliente,

sono lieto di presentarle il nostro innovativo asciugacapelli per pelati, un prodotto unico nel suo genere sviluppato appositamente per le esigenze dei clienti con capelli radi o assenti.

Questo asciugacapelli Ã¨ stato progettato con una tecnologia all''avanguardia che garantisce una rapida e uniforme asciugatura, senza danneggiare il cuoio capelluto. Il design ergonomico e leggero lo rende estremamente comodo e facile da maneggiare.

Grazie alle sue prestazioni superiori e all''attenzione ai dettagli, l''asciugacapelli per pelati Acme rappresenta la soluzione ideale per chi desidera prendersi cura della propria immagine in modo pratico e professionale.

Rimango a disposizione per qualsiasi informazione o chiarimento. Le invio i miei migliori saluti.

Cordialmente,
[Nome]
Responsabile Vendite Acme', 12, '2025-12-22 16:40:06.695678', 'assistant', '2025-12-22 16:40:06.695678') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:52:in 'AiService#genera'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:52:in 'AiService#genera'
Completed 200 OK in 4078ms (Views: 0.2ms | ActiveRecord: 26.3ms (6 queries, 0 cached) | GC: 0.3ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:40:06 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 17:40:27 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "riesci a farlo piÃº corto?\n", "tone" => "Formale", "company_id" => 1, "conversation_id" => 12, "generator" => {"prompt" => "riesci a farlo piÃº corto?\n", "tone" => "Formale", "company_id" => 1, "conversation_id" => 12}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 12 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:100:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:22:in 'AiService#genera'
  [1m[36mMessage Load (0.5ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 12 ORDER BY "messages"."created_at" DESC LIMIT 2 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:27:in 'AiService#genera'
Bedrock model_id: anthropic.claude-3-haiku-20240307-v1:0
Errore interno: Aws::BedrockRuntime::Errors::AccessDeniedException - Model access is denied due to IAM user or service role is not authorized to perform the required AWS Marketplace actions (aws-marketplace:ViewSubscriptions, aws-marketplace:Subscribe) to enable access to this model. Refer to the Amazon Bedrock documentation for further details. Your AWS Marketplace subscription for this model cannot be completed at this time. If you recently fixed this issue, try again after 5 minutes.
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:36:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 686ms (Views: 0.2ms | ActiveRecord: 1.6ms (4 queries, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-22 17:40:39 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "riesci a farlo piÃº corto?\n", "tone" => "Formale", "company_id" => 1, "conversation_id" => 12, "generator" => {"prompt" => "riesci a farlo piÃº corto?\n", "tone" => "Formale", "company_id" => 1, "conversation_id" => 12}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 12 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:100:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:22:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 12 ORDER BY "messages"."created_at" DESC LIMIT 2 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:27:in 'AiService#genera'
Bedrock model_id: anthropic.claude-3-haiku-20240307-v1:0
Errore interno: Aws::BedrockRuntime::Errors::AccessDeniedException - Model access is denied due to IAM user or service role is not authorized to perform the required AWS Marketplace actions (aws-marketplace:ViewSubscriptions, aws-marketplace:Subscribe) to enable access to this model. Refer to the Amazon Bedrock documentation for further details. Your AWS Marketplace subscription for this model cannot be completed at this time. If you recently fixed this issue, try again after 5 minutes.
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:36:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 543ms (Views: 0.1ms | ActiveRecord: 1.7ms (4 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:43:04 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:43:04 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.5ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 248ms (Views: 6.4ms | ActiveRecord: 28.2ms (2 queries, 0 cached) | GC: 0.3ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:43:04 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 15ms (Views: 0.2ms | ActiveRecord: 3.3ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 17:43:07 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Istituzionale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Istituzionale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:120:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.7ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 16:43:07.727513', NULL, NULL, '2025-12-22 16:43:07.727513') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:120:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:120:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.6ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:22:in 'AiService#genera'
  [1m[36mMessage Load (2.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 13 ORDER BY "messages"."created_at" DESC LIMIT 2 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:27:in 'AiService#genera'
Bedrock region: us-east-1; model_id: anthropic.claude-3-haiku-20240307-v1:0
Bedrock access denied for model 'anthropic.claude-3-haiku-20240307-v1:0' in region 'us-east-1': Model access is denied due to IAM user or service role is not authorized to perform the required AWS Marketplace actions (aws-marketplace:ViewSubscriptions, aws-marketplace:Subscribe) to enable access to this model. Refer to the Amazon Bedrock documentation for further details. Your AWS Marketplace subscription for this model cannot be completed at this time. If you recently fixed this issue, try again after 5 minutes.
Errore interno: Aws::BedrockRuntime::Errors::AccessDeniedException - Model access is denied due to IAM user or service role is not authorized to perform the required AWS Marketplace actions (aws-marketplace:ViewSubscriptions, aws-marketplace:Subscribe) to enable access to this model. Refer to the Amazon Bedrock documentation for further details. Your AWS Marketplace subscription for this model cannot be completed at this time. If you recently fixed this issue, try again after 5 minutes.
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:63:in 'AiService#converse_with_model'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:39:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 724ms (Views: 0.1ms | ActiveRecord: 10.7ms (4 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:52:15 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:52:15 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.9ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 191ms (Views: 0.2ms | ActiveRecord: 21.7ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:52:16 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (2.0ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 34ms (Views: 5.4ms | ActiveRecord: 6.5ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 17:52:17 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:119:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.5ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 16:52:18.105619', NULL, NULL, '2025-12-22 16:52:18.105619') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:119:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:119:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.6ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:22:in 'AiService#genera'
  [1m[36mMessage Load (1.9ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 14 ORDER BY "messages"."created_at" DESC LIMIT 2 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:27:in 'AiService#genera'
Errore interno: NameError - undefined local variable or method 'region' for an instance of AiService
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:33:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 212ms (Views: 0.1ms | ActiveRecord: 10.3ms (4 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:53:20 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:53:20 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.9ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 230ms (Views: 5.9ms | ActiveRecord: 24.9ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:53:21 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (2.3ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 14ms (Views: 0.1ms | ActiveRecord: 4.0ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 17:53:24 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:120:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.7ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 16:53:24.890179', NULL, NULL, '2025-12-22 16:53:24.890179') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:120:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:120:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:22:in 'AiService#genera'
  [1m[36mMessage Load (1.8ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 15 ORDER BY "messages"."created_at" DESC LIMIT 2 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:27:in 'AiService#genera'
Bedrock region: us-east-1; model_id: anthropic.claude-3-5-sonnet-20241022-v2:0
Errore interno: Aws::BedrockRuntime::Errors::ValidationException - Invocation of model ID anthropic.claude-3-5-sonnet-20241022-v2:0 with on-demand throughput isnâ€™t supported. Retry your request with the ID or ARN of an inference profile that contains this model.
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:63:in 'AiService#converse_with_model'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:39:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 723ms (Views: 0.2ms | ActiveRecord: 10.6ms (4 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:55:42 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:55:42 +0100
  [1m[36mActiveRecord::SchemaMigration Load (2.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 178ms (Views: 0.2ms | ActiveRecord: 21.3ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:55:43 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.7ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 33ms (Views: 5.5ms | ActiveRecord: 6.2ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 17:55:44 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:132:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.7ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 16:55:44.450769', NULL, NULL, '2025-12-22 16:55:44.450769') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:132:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:132:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:23:in 'AiService#genera'
  [1m[36mMessage Load (2.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 16 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:30:in 'AiService#genera'
Bedrock error 'Aws::BedrockRuntime::Errors::AccessDeniedException' for model 'anthropic.claude-3-haiku-20240307-v1:0': Model access is denied due to IAM user or service role is not authorized to perform the required AWS Marketplace actions (aws-marketplace:ViewSubscriptions, aws-marketplace:Subscribe) to enable access to this model. Refer to the Amazon Bedrock documentation for further details. Your AWS Marketplace subscription for this model cannot be completed at this time. If you recently fixed this issue, try again after 5 minutes.
Errore interno: Aws::BedrockRuntime::Errors::AccessDeniedException - Model access is denied due to IAM user or service role is not authorized to perform the required AWS Marketplace actions (aws-marketplace:ViewSubscriptions, aws-marketplace:Subscribe) to enable access to this model. Refer to the Amazon Bedrock documentation for further details. Your AWS Marketplace subscription for this model cannot be completed at this time. If you recently fixed this issue, try again after 5 minutes.
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:67:in 'AiService#converse_with_model'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:41:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 829ms (Views: 0.1ms | ActiveRecord: 10.8ms (4 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:58:40 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:58:40 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:58:40 +0100
Completed 200 OK in 299ms (Views: 0.2ms | ActiveRecord: 20.9ms (1 query, 0 cached) | GC: 0.0ms)


Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.1ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.7ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 33ms (Views: 5.9ms | ActiveRecord: 6.0ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 17:58:41 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:132:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.8ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 16:58:41.713370', NULL, NULL, '2025-12-22 16:58:41.713370') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:132:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:132:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:23:in 'AiService#genera'
  [1m[36mMessage Load (2.3ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 17 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:30:in 'AiService#genera'
Errore interno: Aws::BedrockRuntime::Errors::ResourceNotFoundException - This model version has reached the end of its life. Please refer to the AWS documentation for more details.
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:67:in 'AiService#converse_with_model'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:41:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 728ms (Views: 0.1ms | ActiveRecord: 10.8ms (4 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 17:59:59 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 17:59:59 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 217ms (Views: 6.0ms | ActiveRecord: 24.8ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:00:00 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (2.1ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 14ms (Views: 0.2ms | ActiveRecord: 3.6ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:00:02 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:132:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.1ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 17:00:02.445094', NULL, NULL, '2025-12-22 17:00:02.445094') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:132:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:132:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.6ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:23:in 'AiService#genera'
  [1m[36mMessage Load (1.8ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 18 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:30:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mMessage Create (5.6ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un''email di presentazione del prodotto.', 18, '2025-12-22 17:00:05.585504', 'user', '2025-12-22 17:00:05.585504') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mMessage Create (6.0ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('

Subject: Introducing Acme''s Latest Innovation: Suite B2B

Dear [Recipient],

I''m thrilled to introduce you to Acme''s latest game-changer: Suite B2B! As the official AI of Acme, I''m excited to share this cutting-edge solution with you.

Suite B2B is a comprehensive suite of tools designed to streamline your business operations, enhance collaboration, and drive growth. With its user-friendly interface and robust features, you''ll be able to:

* Automate tedious tasks and focus on high-priority projects
* Enhance team communication and collaboration
* Gain valuable insights and make data-driven decisions
* Improve customer engagement and satisfaction

Our team has worked tirelessly to craft a solution that addresses the unique needs of businesses like yours. With Suite B2B, you''ll experience:

* Increased productivity and efficiency
* Improved customer relationships
* Enhanced competitiveness in the market
* Scalability and flexibility to adapt to your growing needs

I''d love to schedule a demo to show you how Suite B2B can transform your business. Simply reply to this email, and I''ll set up a time that suits you best.

Looking forward to exploring the possibilities with you!

Best regards,

[Your Name]
Acme''s Official AI', 18, '2025-12-22 17:00:05.600369', 'assistant', '2025-12-22 17:00:05.600369') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
Completed 200 OK in 3350ms (Views: 0.1ms | ActiveRecord: 24.7ms (6 queries, 0 cached) | GC: 0.5ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:00:05 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:00:52 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:00:52 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 283ms (Views: 0.2ms | ActiveRecord: 20.7ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:00:53 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.5ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 35ms (Views: 5.5ms | ActiveRecord: 6.5ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:01:05 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto asciugacapelli per pelati.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto asciugacapelli per pelati.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:132:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.4ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 17:01:05.961756', NULL, NULL, '2025-12-22 17:01:05.961756') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:132:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:132:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.6ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:23:in 'AiService#genera'
  [1m[36mMessage Load (2.0ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 19 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:30:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mMessage Create (7.5ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un''email di presentazione del prodotto asciugacapelli per pelati.', 19, '2025-12-22 17:01:08.514128', 'user', '2025-12-22 17:01:08.514128') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (8.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mMessage Create (6.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Scopri il nostro nuovo asciugacapelli per pelati!

Ciao [Nome del destinatario],

Spero che tu stia bene! Sono entusiasta di presentarti la nostra ultima innovazione: l''asciugacapelli per pelati. Progettato per offrire comfort e praticitÃ , questo prodotto rivoluzionario Ã¨ perfetto per chiunque voglia mantenere i capelli asciutti e freschi.

Caratteristiche principali:
- Tecnologia a bassa temperatura per proteggere il cuoio capelluto
- Design ergonomico per un''ottima presa
- Adatto a tutti i tipi di capelli

Non perdere l''occasione di provarlo! Contattaci per maggiori dettagli e per ordinare il tuo campione gratuito.

Cordiali saluti,
[Il tuo nome]
Acme', 19, '2025-12-22 17:01:08.540160', 'assistant', '2025-12-22 17:01:08.540160') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
Completed 200 OK in 2778ms (Views: 0.3ms | ActiveRecord: 32.9ms (6 queries, 0 cached) | GC: 0.3ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:01:08 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-22 18:01:22 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "non usare testo tra parentesi\n", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 19, "generator" => {"prompt" => "non usare testo tra parentesi\n", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 19}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 19 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:131:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:23:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 19 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:30:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mMessage Create (4.1ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('non usare testo tra parentesi
', 19, '2025-12-22 17:01:23.855480', 'user', '2025-12-22 17:01:23.855480') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mMessage Create (5.1ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Scopri il nostro nuovo asciugacapelli per pelati!

Ciao,

Spero che tu stia bene! Sono entusiasta di presentarti la nostra ultima innovazione: l''asciugacapelli per pelati. Progettato per offrire comfort e praticitÃ , questo prodotto rivoluzionario Ã¨ perfetto per chiunque voglia mantenere i capelli asciutti e freschi.

Caratteristiche principali:
- Tecnologia a bassa temperatura per proteggere il cuoio capelluto
- Design ergonomico per un''ottima presa
- Adatto a tutti i tipi di capelli

Non perdere l''occasione di provarlo! Contattaci per maggiori dettagli e per ordinare il tuo campione gratuito.

Cordiali saluti,
[Il tuo nome]
Acme', 19, '2025-12-22 17:01:23.868021', 'assistant', '2025-12-22 17:01:23.868021') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
Completed 200 OK in 1764ms (Views: 0.1ms | ActiveRecord: 13.3ms (6 queries, 0 cached) | GC: 0.5ms)


Started POST "/genera" for ::1 at 2025-12-22 18:01:46 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "lo hai fatto di nuovo. Voglio il testo pi;u corto", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 19, "generator" => {"prompt" => "lo hai fatto di nuovo. Voglio il testo pi;u corto", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 19}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 19 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:131:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:23:in 'AiService#genera'
  [1m[36mMessage Load (0.5ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 19 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:30:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mMessage Create (4.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('lo hai fatto di nuovo. Voglio il testo pi;u corto', 19, '2025-12-22 17:01:47.458877', 'user', '2025-12-22 17:01:47.458877') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (7.9ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mMessage Create (5.0ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Nuovo asciugacapelli per pelati

Ciao,

Presentiamo il nostro nuovo asciugacapelli per pelati. Tecnologia a bassa temperatura, design ergonomico e adatto a tutti i tipi di capelli. Facile da usare e molto pratico.

Contattaci per maggiori dettagli e per un campione gratuito.

Cordiali saluti,
[Il tuo nome]
Acme', 19, '2025-12-22 17:01:47.478314', 'assistant', '2025-12-22 17:01:47.478314') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
Completed 200 OK in 1406ms (Views: 0.1ms | ActiveRecord: 20.0ms (6 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:01:58 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "continui a lasciare il tuo nome sotto", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 19, "generator" => {"prompt" => "continui a lasciare il tuo nome sotto", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 19}}
  [1m[36mCompany Load (0.7ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mConversation Load (0.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 19 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:131:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.6ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:23:in 'AiService#genera'
  [1m[36mMessage Load (0.6ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 19 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:30:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mMessage Create (3.8ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('continui a lasciare il tuo nome sotto', 19, '2025-12-22 17:02:00.040948', 'user', '2025-12-22 17:02:00.040948') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mMessage Create (5.2ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Nuovo asciugacapelli per pelati

Ciao,

Presentiamo il nostro nuovo asciugacapelli per pelati. Tecnologia a bassa temperatura, design ergonomico e adatto a tutti i tipi di capelli. Facile da usare e molto pratico.

Contattaci per maggiori dettagli e per un campione gratuito.

Cordiali saluti,
[Il tuo nome]
Acme', 19, '2025-12-22 17:02:00.051710', 'assistant', '2025-12-22 17:02:00.051710') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
Completed 200 OK in 1279ms (Views: 0.2ms | ActiveRecord: 12.6ms (6 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:02:13 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "togli l'ultima frase", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 19, "generator" => {"prompt" => "togli l'ultima frase", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 19}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mConversation Load (0.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 19 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:131:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:23:in 'AiService#genera'
  [1m[36mMessage Load (0.8ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 19 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:30:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mMessage Create (4.9ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('togli l''ultima frase', 19, '2025-12-22 17:02:14.552305', 'user', '2025-12-22 17:02:14.552305') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mMessage Create (4.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Nuovo asciugacapelli per pelati

Ciao,

Presentiamo il nostro nuovo asciugacapelli per pelati. Tecnologia a bassa temperatura, design ergonomico e adatto a tutti i tipi di capelli. Facile da usare e molto pratico.

Contattaci per maggiori dettagli.

Cordiali saluti,
Acme', 19, '2025-12-22 17:02:14.564740', 'assistant', '2025-12-22 17:02:14.564740') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
Completed 200 OK in 1151ms (Views: 0.2ms | ActiveRecord: 12.8ms (6 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:02:19 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 19, "generator" => {"prompt" => "", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 19}}
Completed 422 Unprocessable Content in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:02:37 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "ok firmati come Marco Favero il re dei bugbuster", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 19, "generator" => {"prompt" => "ok firmati come Marco Favero il re dei bugbuster", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 19}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:19:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 19 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:131:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:23:in 'AiService#genera'
  [1m[36mMessage Load (0.5ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 19 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:30:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mMessage Create (4.6ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('ok firmati come Marco Favero il re dei bugbuster', 19, '2025-12-22 17:02:38.765762', 'user', '2025-12-22 17:02:38.765762') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:58:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mMessage Create (5.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Nuovo asciugacapelli per pelati

Ciao,

Presentiamo il nostro nuovo asciugacapelli per pelati. Tecnologia a bassa temperatura, design ergonomico e adatto a tutti i tipi di capelli. Facile da usare e molto pratico.

Contattaci per maggiori dettagli.

Cordiali saluti,
Marco Favero, il re dei bugbuster
Acme', 19, '2025-12-22 17:02:38.786207', 'assistant', '2025-12-22 17:02:38.786207') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:59:in 'AiService#genera'
Completed 200 OK in 1261ms (Views: 0.1ms | ActiveRecord: 21.2ms (6 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:16:56 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:16:56 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 177ms (Views: 0.2ms | ActiveRecord: 20.7ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:16:57 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.2ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.7ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 32ms (Views: 5.4ms | ActiveRecord: 6.0ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:17:08 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per guppy.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per guppy.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:174:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.2ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 17:17:08.245350', NULL, NULL, '2025-12-22 17:17:08.245350') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:174:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:174:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (2.0ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 20 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (5.7ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un''email di presentazione del prodotto cibo per guppy.', 20, '2025-12-22 17:17:10.393882', 'user', '2025-12-22 17:17:10.393882') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (6.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Ciao! ðŸŒŸ

Spero che tu stia bene! Mi chiamo [Il tuo nome] e sono entusiasta di presentarti il nostro nuovo prodotto: il cibo per guppy di Acme!

I nostri guppy sono i piÃ¹ felici del mondo, grazie alla nostra formula speciale che garantisce una crescita sana e una colorazione brillante. ðŸŒˆâœ¨

Scopri di piÃ¹ su come il nostro cibo puÃ² migliorare la vita dei tuoi pesciolini e lascia che ti aiutiamo a creare un acquario splendido!

Non vediamo l''ora di sentirti!

Cordiali saluti,
[Il tuo nome]
Team Acme ðŸ ðŸ’š', 20, '2025-12-22 17:17:10.411728', 'assistant', '2025-12-22 17:17:10.411728') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 2366ms (Views: 0.2ms | ActiveRecord: 26.5ms (6 queries, 0 cached) | GC: 0.2ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:17:10 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:17:38 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "non usare [il tuo nome] o contenuti dentro le parentesi", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 20, "generator" => {"prompt" => "non usare [il tuo nome] o contenuti dentro le parentesi", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 20}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 20 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:173:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 20 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (3.8ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('non usare [il tuo nome] o contenuti dentro le parentesi', 20, '2025-12-22 17:17:40.061083', 'user', '2025-12-22 17:17:40.061083') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (4.8ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Ciao! ðŸŒŸ

Spero che tu stia bene! Sono entusiasta di presentarti il nostro nuovo prodotto: il cibo per guppy di Acme!

I nostri guppy sono i piÃ¹ felici del mondo, grazie alla nostra formula speciale che garantisce una crescita sana e una colorazione brillante. ðŸŒˆâœ¨

Scopri di piÃ¹ su come il nostro cibo puÃ² migliorare la vita dei tuoi pesciolini e lascia che ti aiutiamo a creare un acquario splendido!

Non vediamo l''ora di sentirti!

Cordiali saluti,
Team Acme ðŸ ðŸ’š', 20, '2025-12-22 17:17:40.079450', 'assistant', '2025-12-22 17:17:40.079450') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 1388ms (Views: 0.1ms | ActiveRecord: 19.5ms (6 queries, 0 cached) | GC: 0.5ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:19:26 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:19:26 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (2.1ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 242ms (Views: 6.2ms | ActiveRecord: 24.4ms (2 queries, 0 cached) | GC: 0.5ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:19:26 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (2.1ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 15ms (Views: 0.1ms | ActiveRecord: 4.5ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:19:29 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per guppy.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per guppy.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.1ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 17:19:29.825693', NULL, NULL, '2025-12-22 17:19:29.825693') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (2.1ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 21 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (4.6ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un''email di presentazione del prodotto cibo per guppy.', 21, '2025-12-22 17:19:31.364371', 'user', '2025-12-22 17:19:31.364371') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (4.6ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Ciao! 

Siamo lieti di presentarti il nostro nuovo prodotto, il cibo per guppy. Formulato con ingredienti di alta qualitÃ , Ã¨ perfetto per mantenere i tuoi pesciolini sani e felici. Facile da usare e nutriente, Ã¨ la scelta ideale per chi ama prendersi cura dei propri pesciolini.

Non esitare a contattarci per maggiori informazioni!

Cordiali saluti,
Il team Acme', 21, '2025-12-22 17:19:31.376654', 'assistant', '2025-12-22 17:19:31.376654') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 1718ms (Views: 0.2ms | ActiveRecord: 22.0ms (6 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:19:31 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:20:00 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "lo voglio piÃº specifico, deve essere tecnico e informare perchÃ© comprarlo", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 21, "generator" => {"prompt" => "lo voglio piÃº specifico, deve essere tecnico e informare perchÃ© comprarlo", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 21}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 21 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:174:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.3ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 21 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (4.1ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('lo voglio piÃº specifico, deve essere tecnico e informare perchÃ© comprarlo', 21, '2025-12-22 17:20:02.729153', 'user', '2025-12-22 17:20:02.729153') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (4.4ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Certamente!

Oggetto: Scopri il nostro cibo per guppy: qualitÃ  e nutrienti per i tuoi pesciolini

Caro cliente,

Siamo entusiasti di presentarti il nostro nuovo cibo per guppy, formulato con ingredienti di alta qualitÃ  per garantire il benessere dei tuoi pesciolini. Questo prodotto Ã¨ stato sviluppato per fornire una nutrizione completa e bilanciata, con ingredienti selezionati per supportare la salute e la crescita dei guppy.

Il nostro cibo per guppy Ã¨ ricco di proteine, vitamine e minerali essenziali, che aiutano a mantenere i pesciolini sani e vitali. Inoltre, la sua formulazione a lenta dissoluzione permette di evitare lo spreco e l''inquinamento dell''acqua, garantendo un''alimentazione sana e sostenibile.

Scegliendo il nostro cibo per guppy, stai optando per un prodotto di alta qualitÃ  che supporta la salute e il benessere dei tuoi pesciolini. Inoltre, la sua facilitÃ  d''uso lo rende una scelta ideale per chiunque voglia prendersi cura dei propri pesciolini in modo semplice e conveniente.

Non esitare a contattarci per maggiori informazioni o per ordinare il nostro cibo per guppy. Siamo qui per aiutarti a prenderti cura dei tuoi pesciolini nel modo migliore!

Cordiali saluti,
Il team Acme', 21, '2025-12-22 17:20:02.742093', 'assistant', '2025-12-22 17:20:02.742093') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 2635ms (Views: 0.1ms | ActiveRecord: 12.4ms (6 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:27:25 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:27:25 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 194ms (Views: 0.2ms | ActiveRecord: 21.0ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:27:26 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.8ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 32ms (Views: 5.3ms | ActiveRecord: 6.1ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:27:29 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per guppy.", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per guppy.", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.8ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 17:27:29.295811', NULL, NULL, '2025-12-22 17:27:29.295811') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (2.2ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 22 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (5.7ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un''email di presentazione del prodotto cibo per guppy.', 22, '2025-12-22 17:27:31.154514', 'user', '2025-12-22 17:27:31.154514') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (5.9ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Ciao [Nome],

Spero tu stia bene! Volevo presentarti il nostro nuovo prodotto, il cibo per guppy. Ãˆ formulato appositamente per garantire una crescita sana e un colore brillante ai tuoi pesciolini.

Cosa ne dici di provarlo? Se hai domande o vuoi maggiori dettagli, sono qui per aiutarti!

Cordiali saluti,
[Il tuo nome]', 22, '2025-12-22 17:27:31.170888', 'assistant', '2025-12-22 17:27:31.170888') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 2070ms (Views: 0.2ms | ActiveRecord: 25.2ms (6 queries, 0 cached) | GC: 0.2ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:27:31 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:27:54 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "non devi usare copntenuto tra parentesi!!", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 22, "generator" => {"prompt" => "non devi usare copntenuto tra parentesi!!", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 22}}
  [1m[36mCompany Load (0.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 22 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:174:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 22 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (4.1ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('non devi usare copntenuto tra parentesi!!', 22, '2025-12-22 17:27:55.952156', 'user', '2025-12-22 17:27:55.952156') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (8.2ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (4.9ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Ciao,

Spero tu stia bene! Volevo presentarti il nostro nuovo prodotto, il cibo per guppy. Ãˆ formulato appositamente per garantire una crescita sana e un colore brillante ai tuoi pesciolini.

Cosa ne dici di provarlo? Se hai domande o vuoi maggiori dettagli, sono qui per aiutarti!

Cordiali saluti,
[Il tuo nome]', 22, '2025-12-22 17:27:55.971262', 'assistant', '2025-12-22 17:27:55.971262') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 1345ms (Views: 0.1ms | ActiveRecord: 19.8ms (6 queries, 0 cached) | GC: 0.3ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:28:46 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:28:46 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.5ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 220ms (Views: 5.9ms | ActiveRecord: 23.6ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:28:46 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (2.2ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 13ms (Views: 0.1ms | ActiveRecord: 3.6ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:28:50 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per guppy", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per guppy", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.6ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 17:28:50.728735', NULL, NULL, '2025-12-22 17:28:50.728735') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.6ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (2.8ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 23 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (5.7ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un''email di presentazione del prodotto cibo per guppy', 23, '2025-12-22 17:28:53.113044', 'user', '2025-12-22 17:28:53.113044') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (9.3ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (5.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Scopri il Miglior Cibo per i Tuoi Guppy!

Ciao [Nome del Cliente],

Spero che tu stia bene! Da Acme, siamo entusiasti di presentarti il nostro nuovo cibo per guppy, formulato per garantire salute e vitalitÃ  ai tuoi pesciolini.

Il nostro cibo Ã¨ ricco di nutrienti essenziali, ideale per stimolare la crescita e mantenere i colori vivaci. Facile da usare e perfetto per ogni acquario, Ã¨ la scelta ideale per chi ama prendersi cura dei propri pesci.

Non perdere l''occasione di migliorare la vita dei tuoi guppy con il nostro prodotto di alta qualitÃ . Contattaci per maggiori dettagli!

Cordiali saluti,
[Il Tuo Nome]', 23, '2025-12-22 17:28:53.137330', 'assistant', '2025-12-22 17:28:53.137330') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 2602ms (Views: 0.2ms | ActiveRecord: 35.1ms (6 queries, 0 cached) | GC: 0.3ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:28:53 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:31:08 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:31:08 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 176ms (Views: 0.2ms | ActiveRecord: 21.0ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:31:08 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 35ms (Views: 5.6ms | ActiveRecord: 6.2ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:31:11 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per guppy", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto cibo per guppy", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.8ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 17:31:12.075636', NULL, NULL, '2025-12-22 17:31:12.075636') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (1.8ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 24 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (5.6ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un''email di presentazione del prodotto cibo per guppy', 24, '2025-12-22 17:31:14.465571', 'user', '2025-12-22 17:31:14.465571') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (6.0ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Scopri il Miglior Cibo per i Tuoi Guppy!

Ciao [Nome del destinatario],

Spero che tu stia bene! Da Acme, siamo entusiasti di presentarti il nostro nuovo cibo per guppy, pensato per garantire ai tuoi pesciolini una salute ottimale e tanta energia.

Il nostro cibo Ã¨ formulato con ingredienti di alta qualitÃ , ricchi di nutrienti essenziali per mantenere i tuoi guppy attivi e colorati. Perfetto per ogni acquario, Ã¨ disponibile in diverse varietÃ  per soddisfare ogni esigenza.

Non perdere l''occasione di migliorare la vita dei tuoi piccoli amici acquatici. Scopri di piÃ¹ sul nostro sito!

Cordiali saluti,
[Il Tuo Nome]', 24, '2025-12-22 17:31:14.481590', 'assistant', '2025-12-22 17:31:14.481590') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 2589ms (Views: 0.2ms | ActiveRecord: 31.5ms (6 queries, 0 cached) | GC: 0.3ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:31:14 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:33:21 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:33:21 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 180ms (Views: 0.2ms | ActiveRecord: 20.6ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:33:21 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (2.0ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 32ms (Views: 5.2ms | ActiveRecord: 6.6ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:33:30 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:33:30 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mTone Load (2.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 12ms (Views: 4.6ms | ActiveRecord: 3.1ms (2 queries, 0 cached) | GC: 0.0ms)


  [1m[36mConversation Load (134.1ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 139ms (Views: 0.1ms | ActiveRecord: 141.7ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:33:52 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi una mail di presentazione per il prodotto cibo per cani dietetico", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi una mail di presentazione per il prodotto cibo per cani dietetico", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (1.2ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (4.6ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 17:33:53.138235', NULL, NULL, '2025-12-22 17:33:53.138235') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (2.1ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (2.3ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 25 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
Errore interno: Aws::BedrockRuntime::Errors::ExpiredTokenException - The security token included in the request is expired
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:17:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:91:in 'AiService#converse_with_model'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:76:in 'AiService#invoke_bedrock_with_fallback'
C:/Users/marco/Desktop/nexum_poc/app/services/ai_service.rb:60:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 857ms (Views: 0.2ms | ActiveRecord: 20.3ms (4 queries, 0 cached) | GC: 0.2ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:35:15 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:35:15 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
Started GET "/toni?company_id=1" for ::1 at 2025-12-22 18:35:15 +0100
  [1m[36mConversation Load (2.0ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
Completed 200 OK in 310ms (Views: 0.2ms | ActiveRecord: 25.2ms (1 query, 0 cached) | GC: 0.0ms)


  [1m[36mCompany Load (1.1ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.6ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 150ms (Views: 5.9ms | ActiveRecord: 18.8ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:35:49 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi una pubblicitÃ¡ del prodotto pandoro vegano", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Scrivi una pubblicitÃ¡ del prodotto pandoro vegano", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.5ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 17:35:49.585815', NULL, NULL, '2025-12-22 17:35:49.585815') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (2.2ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 26 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (6.9ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi una pubblicitÃ¡ del prodotto pandoro vegano', 26, '2025-12-22 17:35:51.643693', 'user', '2025-12-22 17:35:51.643693') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (8.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (6.8ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Buongiorno! Scopri il nostro delizioso Pandoro Vegano, perfetto per ogni occasione! Senza latticini e uova, Ã¨ una delizia leggera e golosa che delizierÃ  tutti i palati. Ideale per feste e ricorrenze, Ã¨ la scelta perfetta per chi ama la tradizione senza rinunciare alla qualitÃ . Provalo e porta in tavola un tocco di dolcezza senza compromessi!', 26, '2025-12-22 17:35:51.667335', 'assistant', '2025-12-22 17:35:51.667335') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 2395ms (Views: 0.2ms | ActiveRecord: 41.4ms (6 queries, 0 cached) | GC: 0.3ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:35:51 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-22 18:36:26 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Genera uno spot che deve invogliare la gente a comprare soldi di cioccolato", "tone" => "Simpatico", "company_id" => 1, "generator" => {"prompt" => "Genera uno spot che deve invogliare la gente a comprare soldi di cioccolato", "tone" => "Simpatico", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (15.5ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-22 17:36:26.466375', NULL, NULL, '2025-12-22 17:36:26.466375') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (0.5ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 27 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (4.0ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Genera uno spot che deve invogliare la gente a comprare soldi di cioccolato', 27, '2025-12-22 17:36:27.909071', 'user', '2025-12-22 17:36:27.909071') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (5.0ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scopri il piacere del gustoso cioccolato con i nostri soldi di cioccolato! Ogni moneta Ã¨ una delizia croccante, perfetta per soddisfare la tua voglia di dolce. Ideali come regalo o per coccolarti, sono un modo goloso di portare un sorriso in ogni portafoglio. Acquista i nostri soldi di cioccolato e rendi ogni momento ancora piÃ¹ speciale!', 27, '2025-12-22 17:36:27.920102', 'assistant', '2025-12-22 17:36:27.920102') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 1476ms (Views: 0.2ms | ActiveRecord: 27.9ms (6 queries, 0 cached) | GC: 0.2ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-22 18:36:27 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-22 18:36:43 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "fallo piÃº estremo e simpatico", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 27, "generator" => {"prompt" => "fallo piÃº estremo e simpatico", "tone" => "Simpatico", "company_id" => 1, "conversation_id" => 27}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mConversation Load (0.3ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 27 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:174:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Simpatico' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 27 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (4.2ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('fallo piÃº estremo e simpatico', 27, '2025-12-22 17:36:45.145017', 'user', '2025-12-22 17:36:45.145017') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (8.2ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (4.9ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Salta sulla nostra montagna di cioccolato con i nostri soldi di cioccolato! Ogni moneta Ã¨ un''avventura per il palato, un''esplosione di gusto che ti farÃ  sentire come se stessi camminando su una nuvola di dolcezza. Perfette per sorprendere e deliziare, sono l''idea perfetta per un regalo che lascia senza parole o per coccolarti in un modo irresistibile. Immergiti nel mondo del cioccolato e lascia che ogni moneta ti porti in un viaggio di gusto indimenticabile!', 27, '2025-12-22 17:36:45.164000', 'assistant', '2025-12-22 17:36:45.164000') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 1969ms (Views: 0.2ms | ActiveRecord: 19.8ms (6 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (3.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (4.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (264.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "nexum_poc_development" /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (206.1ms)[0m  [1m[35mDROP DATABASE IF EXISTS "nexum_poc_test" /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (441.0ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_development" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.1ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35m (343.3ms)[0m  [1m[35mCREATE DATABASE "nexum_poc_test" ENCODING = 'unicode' /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[35mSQL (1.7ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql" SCHEMA pg_catalog /*application='NexumPoc'*/[0m
  [1m[35m (0.9ms)[0m  [1m[35mDROP TABLE IF EXISTS "companies" CASCADE /*application='NexumPoc'*/[0m
  [1m[35m (17.6ms)[0m  [1m[35mCREATE TABLE "companies" ("id" bigserial primary key, "created_at" timestamp(6) NOT NULL, "description" text, "name" character varying NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "conversations" CASCADE /*application='NexumPoc'*/[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "conversations" ("id" bigserial primary key, "company_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "summary" text, "title" character varying, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE INDEX "index_conversations_on_company_id" ON "conversations" ("company_id") /*application='NexumPoc'*/[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "messages" CASCADE /*application='NexumPoc'*/[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "messages" ("id" bigserial primary key, "content" text NOT NULL, "conversation_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "role" character varying NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_messages_on_conversation_id" ON "messages" ("conversation_id") /*application='NexumPoc'*/[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE INDEX "index_messages_on_created_at" ON "messages" ("created_at") /*application='NexumPoc'*/[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "tones" CASCADE /*application='NexumPoc'*/[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "tones" ("id" bigserial primary key, "company_id" bigint, "created_at" timestamp(6) NOT NULL, "instructions" text, "name" character varying, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_tones_on_company_id" ON "tones" ("company_id") /*application='NexumPoc'*/[0m
  [1m[35m (6.2ms)[0m  [1m[35mALTER TABLE "conversations" ADD CONSTRAINT "fk_rails_ea2d28a6d9"
FOREIGN KEY ("company_id")
  REFERENCES "companies" ("id")
 /*application='NexumPoc'*/[0m
  [1m[35m (2.4ms)[0m  [1m[35mALTER TABLE "messages" ADD CONSTRAINT "fk_rails_7f927086d2"
FOREIGN KEY ("conversation_id")
  REFERENCES "conversations" ("id")
 /*application='NexumPoc'*/[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "tones" ADD CONSTRAINT "fk_rails_defed01769"
FOREIGN KEY ("company_id")
  REFERENCES "companies" ("id")
 /*application='NexumPoc'*/[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20251221120001) /*application='NexumPoc'*/[0m
  [1m[35m (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20251221120000),
(20251219120000),
(20251219090625); /*application='NexumPoc'*/[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.8ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'development', '2025-12-23 08:44:37.945729', '2025-12-23 08:44:37.945743') RETURNING "key" /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'schema_sha1' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', '95ef493f1b87b463bcdc48d1be6339904cd43eed', '2025-12-23 08:44:37.955016', '2025-12-23 08:44:37.955018') RETURNING "key" /*application='NexumPoc'*/[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_try_advisory_lock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.1ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.1ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.1ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.1ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mMessage Delete All (1.4ms)[0m  [1m[31mDELETE FROM "messages" /*application='NexumPoc'*/[0m
  [1m[36mConversation Delete All (1.1ms)[0m  [1m[31mDELETE FROM "conversations" /*application='NexumPoc'*/[0m
  [1m[36mTone Delete All (1.1ms)[0m  [1m[31mDELETE FROM "tones" /*application='NexumPoc'*/[0m
  [1m[36mCompany Delete All (0.7ms)[0m  [1m[31mDELETE FROM "companies" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mCompany Create (4.2ms)[0m  [1m[32mINSERT INTO "companies" ("id", "created_at", "description", "name", "updated_at") VALUES (1, '2025-12-23 08:44:51.252052', 'Suite B2B', 'Acme', '2025-12-23 08:44:51.252052') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (4.4ms)[0m  [1m[32mINSERT INTO "tones" ("company_id", "created_at", "instructions", "name", "updated_at") VALUES (1, '2025-12-23 08:44:51.304609', 'Tono amichevole e leggero', 'Simpatico', '2025-12-23 08:44:51.304609') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (3.8ms)[0m  [1m[32mINSERT INTO "tones" ("company_id", "created_at", "instructions", "name", "updated_at") VALUES (1, '2025-12-23 08:44:51.315762', 'Tono professionale e conciso', 'Formale', '2025-12-23 08:44:51.315762') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mTone Create (3.8ms)[0m  [1m[32mINSERT INTO "tones" ("company_id", "created_at", "instructions", "name", "updated_at") VALUES (1, '2025-12-23 08:44:51.325923', 'Tono autorevole e preciso', 'Istituzionale', '2025-12-23 08:44:51.325923') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mConversation Create (4.8ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-23 08:44:51.394508', NULL, 'Esempio', '2025-12-23 08:44:51.394508') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mMessage Create (4.7ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un breve post di prova.', 1, '2025-12-23 08:44:51.410649', 'user', '2025-12-23 08:44:51.410649') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[36mMessage Create (4.0ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Ecco un breve post di prova per la suite B2B di Acme.', 1, '2025-12-23 08:44:51.422621', 'assistant', '2025-12-23 08:44:51.422621') RETURNING "id" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[36mTone Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "tones" WHERE "tones"."company_id" = 1 /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/favicon.ico" for ::1 at 2025-12-23 09:45:07 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-23 09:45:07 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-23 09:45:07 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
  
ActionController::RoutingError (No route matches [GET] "/favicon.ico"):
  
Started GET "/toni?company_id=1" for ::1 at 2025-12-23 09:45:07 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-23 09:45:07 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (10.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (3.1ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 566ms (Views: 9.5ms | ActiveRecord: 93.4ms (2 queries, 0 cached) | GC: 0.0ms)


  [1m[36mConversation Load (9.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 583ms (Views: 0.2ms | ActiveRecord: 53.0ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-23 09:45:18 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (1.9ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 404 Not Found in 5ms (Views: 0.1ms | ActiveRecord: 1.9ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-23 09:45:22 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.8ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 9ms (Views: 3.4ms | ActiveRecord: 2.2ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-23 09:45:44 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un email di pubblicitÃ¡ di cibo per cani", "tone" => "Formale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un email di pubblicitÃ¡ di cibo per cani", "tone" => "Formale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.1ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-23 08:45:46.054468', NULL, NULL, '2025-12-23 08:45:46.054468') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:175:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.6ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (2.2ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 2 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (4.4ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un email di pubblicitÃ¡ di cibo per cani', 2, '2025-12-23 08:45:47.498291', 'user', '2025-12-23 08:45:47.498291') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (4.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Scopri la Nuova Linea di Alimenti per Cani di Acme

Caro Partner,

Siamo entusiasti di presentare la nostra nuova linea di alimenti per cani, formulati con ingredienti di alta qualitÃ  per garantire il benessere e la salute dei vostri clienti.

- Ingredienti naturali e nutrienti
- VarietÃ  di gusti e consistenze
- Adatti a diverse esigenze e razze

Visita il nostro sito per maggiori dettagli e scopri come possiamo supportare la tua attivitÃ .

Cordiali saluti,
Team Acme', 2, '2025-12-23 08:45:47.510301', 'assistant', '2025-12-23 08:45:47.510301') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 2542ms (Views: 0.1ms | ActiveRecord: 21.0ms (6 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-23 09:45:47 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-23 09:45:59 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "fallo piÃº corto", "tone" => "Formale", "company_id" => 1, "conversation_id" => 2, "generator" => {"prompt" => "fallo piÃº corto", "tone" => "Formale", "company_id" => 1, "conversation_id" => 2}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mConversation Load (0.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 2 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:174:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 2 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (4.8ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('fallo piÃº corto', 2, '2025-12-23 08:46:01.013975', 'user', '2025-12-23 08:46:01.013975') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (4.5ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Nuova Linea di Alimenti per Cani di Acme

Caro Partner,

Presentiamo la nostra nuova linea di alimenti per cani, con ingredienti naturali e nutrienti, disponibili in diverse varietÃ  di gusti e consistenze per soddisfare ogni esigenza.

Visita il nostro sito per maggiori dettagli.

Cordiali saluti,
Team Acme', 2, '2025-12-23 08:46:01.026268', 'assistant', '2025-12-23 08:46:01.026268') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 1052ms (Views: 0.2ms | ActiveRecord: 12.5ms (6 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-23 09:46:13 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "lo voglio piu simpatico", "tone" => "Formale", "company_id" => 1, "conversation_id" => 2, "generator" => {"prompt" => "lo voglio piu simpatico", "tone" => "Formale", "company_id" => 1, "conversation_id" => 2}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:37:in 'AiService#genera'
  [1m[36mConversation Load (0.3ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 2 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:174:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.3ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:40:in 'AiService#genera'
  [1m[36mMessage Load (0.5ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 2 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:47:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mMessage Create (4.7ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('lo voglio piu simpatico', 2, '2025-12-23 08:46:14.570044', 'user', '2025-12-23 08:46:14.570044') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:65:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mMessage Create (4.5ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Scopri la Nuova Linea di Cibo per Cani di Acme!

Caro Partner,

Siamo entusiasti di presentare la nostra nuova linea di cibo per cani, pronti a far saltare di gioia i vostri clienti!

- Ingredienti naturali e gustosi
- VarietÃ  di sapori e consistenze
- Adatti a ogni cane, ogni gusto

Visita il nostro sito per maggiori dettagli e porta la felicitÃ  ai tuoi clienti!

Cordiali saluti,
Team Acme', 2, '2025-12-23 08:46:14.582855', 'assistant', '2025-12-23 08:46:14.582855') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:66:in 'AiService#genera'
Completed 200 OK in 1326ms (Views: 0.1ms | ActiveRecord: 12.3ms (6 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=0" for ::1 at 2025-12-23 09:46:41 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "0"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 0 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-23 09:46:46 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (3.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mCACHE ActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT pg_try_advisory_lock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (4.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
Migrating to CreateActiveStorageTables (20251228141545)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[35m (39.3ms)[0m  [1m[35mCREATE TABLE "active_storage_blobs" ("id" bigserial primary key, "key" character varying NOT NULL, "filename" character varying NOT NULL, "content_type" character varying, "metadata" text, "service_name" character varying NOT NULL, "byte_size" bigint NOT NULL, "checksum" character varying, "created_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_blobs_on_key" ON "active_storage_blobs" ("key") /*application='NexumPoc'*/[0m
  [1m[35m (9.9ms)[0m  [1m[35mCREATE TABLE "active_storage_attachments" ("id" bigserial primary key, "name" character varying NOT NULL, "record_type" character varying NOT NULL, "record_id" bigint NOT NULL, "blob_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_c3b3935057"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
) /*application='NexumPoc'*/[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE INDEX "index_active_storage_attachments_on_blob_id" ON "active_storage_attachments" ("blob_id") /*application='NexumPoc'*/[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_attachments_uniqueness" ON "active_storage_attachments" ("record_type", "record_id", "name", "blob_id") /*application='NexumPoc'*/[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "active_storage_variant_records" ("id" bigserial primary key, "blob_id" bigint NOT NULL, "variation_digest" character varying NOT NULL, CONSTRAINT "fk_rails_993965df05"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
) /*application='NexumPoc'*/[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_variant_records_uniqueness" ON "active_storage_variant_records" ("blob_id", "variation_digest") /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251228141545') RETURNING "version" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_advisory_unlock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.1ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mCACHE ActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_try_advisory_lock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = 'environment' ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1 /*application='NexumPoc'*/[0m
Migrating to CreateDocuments (20251228141607)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc'*/[0m
  [1m[35m (9.0ms)[0m  [1m[35mCREATE TABLE "documents" ("id" bigserial primary key, "status" character varying, "doc_type" character varying, "ai_data" jsonb, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20251228141607') RETURNING "version" /*application='NexumPoc'*/[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT /*application='NexumPoc'*/[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(169507127648478270) /*application='NexumPoc'*/[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public /*application='NexumPoc'*/[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO "$user", public /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (2.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/" for ::1 at 2025-12-28 15:29:23 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#new as HTML
Completed 500 Internal Server Error in 170ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


  
ArgumentError (wrong number of arguments (given 0, expected 1..2)):
  
app/models/document.rb:6:in '<class:Document>'
app/models/document.rb:1:in '<main>'
app/controllers/documents_controller.rb:3:in 'DocumentsController#new'
Started GET "/favicon.ico" for ::1 at 2025-12-28 15:29:24 +0100
  
ActionController::RoutingError (No route matches [GET] "/favicon.ico"):
  
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/" for ::1 at 2025-12-28 15:35:30 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#new as HTML
Completed 204 No Content in 152ms (ActiveRecord: 21.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/" for ::1 at 2025-12-28 15:35:34 +0100
Processing by DocumentsController#new as HTML
Completed 204 No Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/" for ::1 at 2025-12-28 15:35:35 +0100
Processing by DocumentsController#new as HTML
Completed 204 No Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/" for ::1 at 2025-12-28 15:35:39 +0100
Processing by DocumentsController#new as HTML
Completed 204 No Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/" for ::1 at 2025-12-28 15:35:40 +0100
Processing by DocumentsController#new as HTML
Completed 204 No Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/" for ::1 at 2025-12-28 15:37:25 +0100
Processing by DocumentsController#new as HTML
Completed 204 No Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/" for ::1 at 2025-12-28 15:37:27 +0100
Processing by DocumentsController#new as HTML
Completed 204 No Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/" for ::1 at 2025-12-28 15:38:06 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#new as HTML
Completed 204 No Content in 156ms (ActiveRecord: 18.9ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/" for ::1 at 2025-12-28 15:38:12 +0100
Processing by DocumentsController#new as HTML
Completed 204 No Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/" for ::1 at 2025-12-28 15:38:13 +0100
Processing by DocumentsController#new as HTML
Completed 204 No Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/" for ::1 at 2025-12-28 15:38:17 +0100
Processing by DocumentsController#new as HTML
Completed 204 No Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/" for ::1 at 2025-12-28 15:38:47 +0100
Processing by DocumentsController#new as HTML
Completed 204 No Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/" for ::1 at 2025-12-28 15:39:47 +0100
Processing by DocumentsController#new as HTML
Completed 204 No Content in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-28 15:41:59 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-28 15:41:59 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (2.8ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (4.2ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 264ms (Views: 10.9ms | ActiveRecord: 11.1ms (2 queries, 0 cached) | GC: 0.0ms)


  [1m[36mConversation Load (3.6ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 382ms (Views: 0.1ms | ActiveRecord: 18.7ms (1 query, 0 cached) | GC: 0.2ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-28 15:42:19 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-28 15:42:19 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.6ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 1.6ms (1 query, 0 cached) | GC: 0.0ms)


Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (2.1ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 22ms (Views: 10.4ms | ActiveRecord: 3.5ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/documentTtester.html" for ::1 at 2025-12-28 15:47:20 +0100
  
ActionController::RoutingError (No route matches [GET] "/documentTtester.html"):
  
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/documentTtester.html" for ::1 at 2025-12-28 15:47:33 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/documentTtester.html"):
  
Started GET "/documentTtester.html" for ::1 at 2025-12-28 15:47:35 +0100
  
ActionController::RoutingError (No route matches [GET] "/documentTtester.html"):
  
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started POST "/documents" for ::1 at 2025-12-28 15:49:47 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x0000025bf85e1e00 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251228-24096-lscjaq.pdf>, @content_type="application/pdf", @original_filename="Busta paga ESEMPIO.pdf", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"Busta paga ESEMPIO.pdf\"\r\nContent-Type: application/pdf\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mDocument Create (8.1ms)[0m  [1m[32mINSERT INTO "documents" ("status", "doc_type", "ai_data", "created_at", "updated_at") VALUES ('pending', NULL, NULL, '2025-12-28 14:49:48.030501', '2025-12-28 14:49:48.030501') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Load (4.3ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" INNER JOIN "active_storage_attachments" ON "active_storage_blobs"."id" = "active_storage_attachments"."blob_id" WHERE "active_storage_attachments"."record_id" = 1 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.3ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 1 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Create (0.8ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('zyi8jtj44i9fpknaa9j5118rujq9', 'Busta paga ESEMPIO.pdf', 'application/pdf', '{"identified":true}', 'local', 85189, 'JATuvF8vQO1Ak66jZ7GYAA==', '2025-12-28 14:49:48.200406') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Create (1.2ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('original_file', 'Document', 1, 1, '2025-12-28 14:49:48.207171') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mDocument Update (2.9ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 14:49:48.215359' WHERE "documents"."id" = 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
[36m  Disk Storage (17.9ms) [0m[32mUploaded file to key: zyi8jtj44i9fpknaa9j5118rujq9 (checksum: JATuvF8vQO1Ak66jZ7GYAA==)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Update (5.2ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.6ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mDocument Load (0.3ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mDocument Update (0.3ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 14:49:48.310062' WHERE "documents"."id" = 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 1 AND "active_storage_attachments"."record_type" = 'ActiveStorage::Blob' AND "active_storage_attachments"."name" = 'preview_image' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
[ActiveJob] Enqueued AnalyzeDocumentJob (Job ID: 191048e7-0de0-4e72-9ce8-9545290ccf85) to Async(default) with arguments: 1
[ActiveJob] â†³ app/controllers/documents_controller.rb:14:in 'DocumentsController#create'
Completed 201 Created in 1360ms (Views: 0.2ms | ActiveRecord: 49.0ms (11 queries, 0 cached) | GC: 0.2ms)


[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85] Performing AnalyzeDocumentJob (Job ID: 191048e7-0de0-4e72-9ce8-9545290ccf85) from Async(default) enqueued at 2025-12-28T14:49:49.033295500Z with arguments: 1
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   [1m[36mDocument Load (0.5ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 1 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   [1m[36mActiveStorage::Attachment Load (0.6ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 1 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   â†³ app/jobs/analyze_document_job.rb:8:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   â†³ app/jobs/analyze_document_job.rb:10:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   [1m[36mDocument Update (5.7ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'processing', "updated_at" = '2025-12-28 14:49:49.081784' WHERE "documents"."id" = 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   â†³ app/jobs/analyze_document_job.rb:10:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   â†³ app/jobs/analyze_document_job.rb:10:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   [1m[36mActiveStorage::Blob Load (0.4ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 1 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   â†³ app/jobs/analyze_document_job.rb:15:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85] [36m  Disk Storage (0.4ms) [0m[34mDownloaded file from key: zyi8jtj44i9fpknaa9j5118rujq9[0m
Started GET "/documents/1" for ::1 at 2025-12-28 15:49:51 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "1"}
  [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 1 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:29:in 'DocumentsController#show'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/documents/1" for ::1 at 2025-12-28 15:49:53 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "1"}
  [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 1 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:29:in 'DocumentsController#show'
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.2ms)


[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   â†³ app/jobs/analyze_document_job.rb:52:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   [1m[36mDocument Update (5.2ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'completed', "doc_type" = 'cedolino', "ai_data" = '{"tipo_documento":"cedolino","data_competenza":"08/05/2017","codice_fiscale":"LZNNR58A41D548V","dipendente":"FERRARA (FE)"}', "updated_at" = '2025-12-28 14:49:53.950422' WHERE "documents"."id" = 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   â†³ app/jobs/analyze_document_job.rb:52:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85]   â†³ app/jobs/analyze_document_job.rb:52:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [191048e7-0de0-4e72-9ce8-9545290ccf85] Performed AnalyzeDocumentJob (Job ID: 191048e7-0de0-4e72-9ce8-9545290ccf85) from Async(default) in 4892.49ms
Started GET "/documents/1" for ::1 at 2025-12-28 15:49:55 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "1"}
  [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 1 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:29:in 'DocumentsController#show'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started POST "/documents" for ::1 at 2025-12-28 16:01:47 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x00000158dfad6680 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251228-4388-i6wvae.jpg>, @content_type="image/jpeg", @original_filename="BustaPagaDemo.jpg", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"BustaPagaDemo.jpg\"\r\nContent-Type: image/jpeg\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mDocument Create (7.0ms)[0m  [1m[32mINSERT INTO "documents" ("status", "doc_type", "ai_data", "created_at", "updated_at") VALUES ('pending', NULL, NULL, '2025-12-28 15:01:47.734299', '2025-12-28 15:01:47.734299') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Load (3.5ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" INNER JOIN "active_storage_attachments" ON "active_storage_blobs"."id" = "active_storage_attachments"."blob_id" WHERE "active_storage_attachments"."record_id" = 2 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 2 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Create (0.6ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('lkbajzzbgd6eorgi4s2zqxkcxji5', 'BustaPagaDemo.jpg', 'image/jpeg', '{"identified":true}', 'local', 254370, 'cfzEjxmf7crYuhdUmXOA+g==', '2025-12-28 15:01:47.836866') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Create (0.7ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('original_file', 'Document', 2, 2, '2025-12-28 15:01:47.844889') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mDocument Update (1.0ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 15:01:47.849699' WHERE "documents"."id" = 2 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
[36m  Disk Storage (11.3ms) [0m[32mUploaded file to key: lkbajzzbgd6eorgi4s2zqxkcxji5 (checksum: cfzEjxmf7crYuhdUmXOA+g==)[0m
[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: 2bec0219-906e-4589-bd46-350c265d71b2) to Async(default) with arguments: #<GlobalID:0x00000158dd7d9d58 @uri=#<URI::GID gid://nexum-poc/ActiveStorage::Blob/2>>
[ActiveJob] â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
[ActiveJob] Enqueued AnalyzeDocumentJob (Job ID: 469f0c73-0bbb-4a9c-be4e-821edaa29d9f) to Async(default) with arguments: 2
[ActiveJob] â†³ app/controllers/documents_controller.rb:14:in 'DocumentsController#create'
Completed 201 Created in 428ms (Views: 0.3ms | ActiveRecord: 43.9ms (6 queries, 0 cached) | GC: 0.0ms)


[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f] Performing AnalyzeDocumentJob (Job ID: 469f0c73-0bbb-4a9c-be4e-821edaa29d9f) from Async(default) enqueued at 2025-12-28T15:01:47.950733400Z with arguments: 2
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   [1m[36mDocument Load (4.7ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 2 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   [1m[36mActiveStorage::Attachment Load (0.7ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 2 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   â†³ app/jobs/analyze_document_job.rb:8:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   â†³ app/jobs/analyze_document_job.rb:10:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   [1m[36mDocument Update (4.3ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'processing', "updated_at" = '2025-12-28 15:01:47.998698' WHERE "documents"."id" = 2 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   â†³ app/jobs/analyze_document_job.rb:10:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   â†³ app/jobs/analyze_document_job.rb:10:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   [1m[36mActiveStorage::Blob Load (0.4ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 2 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   â†³ app/jobs/analyze_document_job.rb:15:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f] [36m  Disk Storage (0.4ms) [0m[34mDownloaded file from key: lkbajzzbgd6eorgi4s2zqxkcxji5[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [2bec0219-906e-4589-bd46-350c265d71b2]   [1m[36mActiveStorage::Blob Load (124.5ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 2 LIMIT 1 /*application='NexumPoc'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [2bec0219-906e-4589-bd46-350c265d71b2] Performing ActiveStorage::AnalyzeJob (Job ID: 2bec0219-906e-4589-bd46-350c265d71b2) from Async(default) enqueued at 2025-12-28T15:01:47.943280800Z with arguments: #<GlobalID:0x00000158dd6461f8 @uri=#<URI::GID gid://nexum-poc/ActiveStorage::Blob/2>>
[ActiveJob] [ActiveStorage::AnalyzeJob] [2bec0219-906e-4589-bd46-350c265d71b2] Skipping image analysis because the ruby-vips gem isn't installed
[ActiveJob] [ActiveStorage::AnalyzeJob] [2bec0219-906e-4589-bd46-350c265d71b2]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [2bec0219-906e-4589-bd46-350c265d71b2]   [1m[36mActiveStorage::Blob Update (7.0ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 2 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [2bec0219-906e-4589-bd46-350c265d71b2]   [1m[36mActiveStorage::Attachment Load (7.2ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 2 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [2bec0219-906e-4589-bd46-350c265d71b2]   [1m[36mDocument Load (2.9ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 2 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [2bec0219-906e-4589-bd46-350c265d71b2]   [1m[36mDocument Update (0.4ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 15:01:48.170793' WHERE "documents"."id" = 2 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [2bec0219-906e-4589-bd46-350c265d71b2]   [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [2bec0219-906e-4589-bd46-350c265d71b2] Performed ActiveStorage::AnalyzeJob (Job ID: 2bec0219-906e-4589-bd46-350c265d71b2) from Async(default) in 200.39ms
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   â†³ app/jobs/analyze_document_job.rb:59:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   [1m[36mDocument Update (4.1ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'failed', "ai_data" = '{"error":"The model returned the following errors: The detected file MIME type image/jpeg does not match the expected type application/pdf. Reformat your input and try again."}', "updated_at" = '2025-12-28 15:01:49.403780' WHERE "documents"."id" = 2 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   â†³ app/jobs/analyze_document_job.rb:59:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f]   â†³ app/jobs/analyze_document_job.rb:59:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f] AI Error: The model returned the following errors: The detected file MIME type image/jpeg does not match the expected type application/pdf. Reformat your input and try again.
[ActiveJob] [AnalyzeDocumentJob] [469f0c73-0bbb-4a9c-be4e-821edaa29d9f] Performed AnalyzeDocumentJob (Job ID: 469f0c73-0bbb-4a9c-be4e-821edaa29d9f) from Async(default) in 1430.9ms
Started GET "/documents/2" for ::1 at 2025-12-28 16:01:49 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "2"}
  [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 2 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:29:in 'DocumentsController#show'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started POST "/documents" for ::1 at 2025-12-28 16:04:44 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x00000276472732f0 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251228-25180-mj7p71.jpg>, @content_type="image/jpeg", @original_filename="BustaPagaDemo.jpg", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"BustaPagaDemo.jpg\"\r\nContent-Type: image/jpeg\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mDocument Create (4.4ms)[0m  [1m[32mINSERT INTO "documents" ("status", "doc_type", "ai_data", "created_at", "updated_at") VALUES ('pending', NULL, NULL, '2025-12-28 15:04:45.227982', '2025-12-28 15:04:45.227982') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Load (2.9ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" INNER JOIN "active_storage_attachments" ON "active_storage_blobs"."id" = "active_storage_attachments"."blob_id" WHERE "active_storage_attachments"."record_id" = 3 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 3 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Create (0.5ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('0j7sjwdkixkc9zsaei9jxsxlrg0f', 'BustaPagaDemo.jpg', 'image/jpeg', '{"identified":true}', 'local', 254370, 'cfzEjxmf7crYuhdUmXOA+g==', '2025-12-28 15:04:45.310251') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Create (0.7ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('original_file', 'Document', 3, 3, '2025-12-28 15:04:45.319558') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mDocument Update (1.1ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 15:04:45.326438' WHERE "documents"."id" = 3 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
[36m  Disk Storage (11.1ms) [0m[32mUploaded file to key: 0j7sjwdkixkc9zsaei9jxsxlrg0f (checksum: cfzEjxmf7crYuhdUmXOA+g==)[0m
[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: e61352bb-2ee0-4656-a9fc-fe75c69ece35) to Async(default) with arguments: #<GlobalID:0x00000276411720f0 @uri=#<URI::GID gid://nexum-poc/ActiveStorage::Blob/3>>
[ActiveJob] â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
[ActiveJob] Enqueued AnalyzeDocumentJob (Job ID: 269bd64f-46cd-467e-b16a-41e5fe6ba854) to Async(default) with arguments: 3
[ActiveJob] â†³ app/controllers/documents_controller.rb:14:in 'DocumentsController#create'
Completed 201 Created in 411ms (Views: 0.3ms | ActiveRecord: 32.2ms (6 queries, 0 cached) | GC: 0.6ms)


[ActiveJob] [ActiveStorage::AnalyzeJob] [e61352bb-2ee0-4656-a9fc-fe75c69ece35]   [1m[36mActiveStorage::Blob Load (0.4ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 3 LIMIT 1 /*application='NexumPoc'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [e61352bb-2ee0-4656-a9fc-fe75c69ece35] Performing ActiveStorage::AnalyzeJob (Job ID: e61352bb-2ee0-4656-a9fc-fe75c69ece35) from Async(default) enqueued at 2025-12-28T15:04:45.415048900Z with arguments: #<GlobalID:0x00000276448c6538 @uri=#<URI::GID gid://nexum-poc/ActiveStorage::Blob/3>>
[ActiveJob] [ActiveStorage::AnalyzeJob] [e61352bb-2ee0-4656-a9fc-fe75c69ece35] Skipping image analysis because the ruby-vips gem isn't installed
[ActiveJob] [ActiveStorage::AnalyzeJob] [e61352bb-2ee0-4656-a9fc-fe75c69ece35]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [e61352bb-2ee0-4656-a9fc-fe75c69ece35]   [1m[36mActiveStorage::Blob Update (4.7ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 3 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [e61352bb-2ee0-4656-a9fc-fe75c69ece35]   [1m[36mActiveStorage::Attachment Load (0.7ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 3 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854] Performing AnalyzeDocumentJob (Job ID: 269bd64f-46cd-467e-b16a-41e5fe6ba854) from Async(default) enqueued at 2025-12-28T15:04:45.430495600Z with arguments: 3
[ActiveJob] [ActiveStorage::AnalyzeJob] [e61352bb-2ee0-4656-a9fc-fe75c69ece35]   [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 3 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [e61352bb-2ee0-4656-a9fc-fe75c69ece35]   [1m[36mDocument Update (0.3ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 15:04:45.501158' WHERE "documents"."id" = 3 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [e61352bb-2ee0-4656-a9fc-fe75c69ece35]   [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [e61352bb-2ee0-4656-a9fc-fe75c69ece35] Performed ActiveStorage::AnalyzeJob (Job ID: e61352bb-2ee0-4656-a9fc-fe75c69ece35) from Async(default) in 53.83ms
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   [1m[36mDocument Load (232.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 3 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   [1m[36mActiveStorage::Attachment Load (2.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 3 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   â†³ app/jobs/analyze_document_job.rb:8:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   â†³ app/jobs/analyze_document_job.rb:10:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   [1m[36mDocument Update (4.4ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'processing', "updated_at" = '2025-12-28 15:04:45.727575' WHERE "documents"."id" = 3 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   â†³ app/jobs/analyze_document_job.rb:10:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   â†³ app/jobs/analyze_document_job.rb:10:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   [1m[36mActiveStorage::Blob Load (1.7ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 3 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   â†³ app/jobs/analyze_document_job.rb:15:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854] [36m  Disk Storage (0.5ms) [0m[34mDownloaded file from key: 0j7sjwdkixkc9zsaei9jxsxlrg0f[0m
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   â†³ app/jobs/analyze_document_job.rb:69:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   [1m[36mDocument Update (3.8ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'failed', "ai_data" = '{"error":"1 validation error detected: Value at ''messages.1.member.content.1.member.document.format'' failed to satisfy constraint: Member must satisfy enum value set: [docx, csv, html, txt, pdf, md, doc, xlsx, xls]"}', "updated_at" = '2025-12-28 15:04:46.985608' WHERE "documents"."id" = 3 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   â†³ app/jobs/analyze_document_job.rb:69:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854]   â†³ app/jobs/analyze_document_job.rb:69:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854] AI Error: 1 validation error detected: Value at 'messages.1.member.content.1.member.document.format' failed to satisfy constraint: Member must satisfy enum value set: [docx, csv, html, txt, pdf, md, doc, xlsx, xls]
[ActiveJob] [AnalyzeDocumentJob] [269bd64f-46cd-467e-b16a-41e5fe6ba854] Performed AnalyzeDocumentJob (Job ID: 269bd64f-46cd-467e-b16a-41e5fe6ba854) from Async(default) in 1516.93ms
Started GET "/documents/3" for ::1 at 2025-12-28 16:04:47 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "3"}
  [1m[36mDocument Load (0.6ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 3 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:29:in 'DocumentsController#show'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms (1 query, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started POST "/documents" for ::1 at 2025-12-28 16:06:04 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x0000020713f93168 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251228-24920-ozm0t9.jpg>, @content_type="image/jpeg", @original_filename="BustaPagaDemo.jpg", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"BustaPagaDemo.jpg\"\r\nContent-Type: image/jpeg\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mDocument Create (4.1ms)[0m  [1m[32mINSERT INTO "documents" ("status", "doc_type", "ai_data", "created_at", "updated_at") VALUES ('pending', NULL, NULL, '2025-12-28 15:06:05.439856', '2025-12-28 15:06:05.439856') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Load (3.4ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" INNER JOIN "active_storage_attachments" ON "active_storage_blobs"."id" = "active_storage_attachments"."blob_id" WHERE "active_storage_attachments"."record_id" = 4 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.5ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 4 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Create (0.5ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('hirdasmkgmfyllxqgr089sg6yj19', 'BustaPagaDemo.jpg', 'image/jpeg', '{"identified":true}', 'local', 254370, 'cfzEjxmf7crYuhdUmXOA+g==', '2025-12-28 15:06:05.517322') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Create (0.7ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('original_file', 'Document', 4, 4, '2025-12-28 15:06:05.527486') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mDocument Update (1.2ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 15:06:05.535900' WHERE "documents"."id" = 4 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
[36m  Disk Storage (11.9ms) [0m[32mUploaded file to key: hirdasmkgmfyllxqgr089sg6yj19 (checksum: cfzEjxmf7crYuhdUmXOA+g==)[0m
[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: 6cf0450b-8a84-4db0-9410-68f8852668dd) to Async(default) with arguments: #<GlobalID:0x000002070e8ac1d8 @uri=#<URI::GID gid://nexum-poc/ActiveStorage::Blob/4>>
[ActiveJob] â†³ app/controllers/documents_controller.rb:12:in 'DocumentsController#create'
[ActiveJob] Enqueued AnalyzeDocumentJob (Job ID: 491f8279-2ea0-4c36-b3bc-4b538b0947dc) to Async(default) with arguments: 4
[ActiveJob] â†³ app/controllers/documents_controller.rb:14:in 'DocumentsController#create'
Completed 201 Created in 410ms (Views: 0.2ms | ActiveRecord: 34.9ms (6 queries, 0 cached) | GC: 0.2ms)


[ActiveJob] [ActiveStorage::AnalyzeJob] [6cf0450b-8a84-4db0-9410-68f8852668dd]   [1m[36mActiveStorage::Blob Load (0.4ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 4 LIMIT 1 /*application='NexumPoc'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [6cf0450b-8a84-4db0-9410-68f8852668dd] Performing ActiveStorage::AnalyzeJob (Job ID: 6cf0450b-8a84-4db0-9410-68f8852668dd) from Async(default) enqueued at 2025-12-28T15:06:05.625978200Z with arguments: #<GlobalID:0x00000207115d2d38 @uri=#<URI::GID gid://nexum-poc/ActiveStorage::Blob/4>>
[ActiveJob] [ActiveStorage::AnalyzeJob] [6cf0450b-8a84-4db0-9410-68f8852668dd] Skipping image analysis because the ruby-vips gem isn't installed
[ActiveJob] [ActiveStorage::AnalyzeJob] [6cf0450b-8a84-4db0-9410-68f8852668dd]   [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [6cf0450b-8a84-4db0-9410-68f8852668dd]   [1m[36mActiveStorage::Blob Update (5.1ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 4 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc] Performing AnalyzeDocumentJob (Job ID: 491f8279-2ea0-4c36-b3bc-4b538b0947dc) from Async(default) enqueued at 2025-12-28T15:06:05.638885800Z with arguments: 4
[ActiveJob] [ActiveStorage::AnalyzeJob] [6cf0450b-8a84-4db0-9410-68f8852668dd]   [1m[36mActiveStorage::Attachment Load (4.1ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 4 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [6cf0450b-8a84-4db0-9410-68f8852668dd]   [1m[36mDocument Load (0.5ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 4 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [6cf0450b-8a84-4db0-9410-68f8852668dd]   [1m[36mDocument Update (0.4ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 15:06:05.710795' WHERE "documents"."id" = 4 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [6cf0450b-8a84-4db0-9410-68f8852668dd]   [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [6cf0450b-8a84-4db0-9410-68f8852668dd] Performed ActiveStorage::AnalyzeJob (Job ID: 6cf0450b-8a84-4db0-9410-68f8852668dd) from Async(default) in 53.57ms
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   [1m[36mDocument Load (119.0ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 4 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   [1m[36mActiveStorage::Attachment Load (2.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 4 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   â†³ app/jobs/analyze_document_job.rb:8:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   â†³ app/jobs/analyze_document_job.rb:10:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   [1m[36mDocument Update (4.1ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'processing', "updated_at" = '2025-12-28 15:06:05.816610' WHERE "documents"."id" = 4 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   â†³ app/jobs/analyze_document_job.rb:10:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   â†³ app/jobs/analyze_document_job.rb:10:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   [1m[36mActiveStorage::Blob Load (2.4ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 4 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   â†³ app/jobs/analyze_document_job.rb:14:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc] [36m  Disk Storage (0.4ms) [0m[34mDownloaded file from key: hirdasmkgmfyllxqgr089sg6yj19[0m
Started GET "/documents/4" for ::1 at 2025-12-28 16:06:07 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "4"}
  [1m[36mDocument Load (0.5ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 4 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:29:in 'DocumentsController#show'
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   â†³ app/jobs/analyze_document_job.rb:73:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   [1m[36mDocument Update (3.9ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'completed', "doc_type" = 'Cedolino', "ai_data" = '{"tipo_documento":"Cedolino","data_competenza":"08/05/2017","codice_fiscale":"LDZNRR80A41D0548V","dipendente":"LAZONI E UNIVERSITA'' 2017"}', "updated_at" = '2025-12-28 15:06:08.371851' WHERE "documents"."id" = 4 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   â†³ app/jobs/analyze_document_job.rb:73:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc]   â†³ app/jobs/analyze_document_job.rb:73:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [491f8279-2ea0-4c36-b3bc-4b538b0947dc] Performed AnalyzeDocumentJob (Job ID: 491f8279-2ea0-4c36-b3bc-4b538b0947dc) from Async(default) in 2704.06ms
Started GET "/documents/4" for ::1 at 2025-12-28 16:06:09 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "4"}
  [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 4 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:29:in 'DocumentsController#show'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started POST "/documents" for ::1 at 2025-12-28 16:36:31 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x000001e63eb72778 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251228-11232-cr9uem.jpg>, @content_type="image/jpeg", @original_filename="BustaPagaDemo.jpg", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"BustaPagaDemo.jpg\"\r\nContent-Type: image/jpeg\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
Completed 500 Internal Server Error in 236ms (ActiveRecord: 26.3ms (0 queries, 0 cached) | GC: 0.0ms)


  
NoMethodError (undefined method 'original_file_attached?' for an instance of Document):
  
app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started POST "/documents" for ::1 at 2025-12-28 16:37:07 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x000001a226f335d0 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251228-20004-pqf1im.jpg>, @content_type="image/jpeg", @original_filename="BustaPagaDemo.jpg", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"BustaPagaDemo.jpg\"\r\nContent-Type: image/jpeg\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
Completed 500 Internal Server Error in 244ms (ActiveRecord: 27.2ms (0 queries, 0 cached) | GC: 0.0ms)


  
Psych::AliasesNotEnabled (Alias parsing was not enabled. To enable it, pass `aliases: true` to `Psych::load` or `Psych::safe_load`.):
  
app/models/document.rb:16:in 'Document#original_file_mime_type'
app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started POST "/documents" for ::1 at 2025-12-28 16:38:34 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x000001bdac882690 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251228-21636-72422t.jpg>, @content_type="image/jpeg", @original_filename="BustaPagaDemo.jpg", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"BustaPagaDemo.jpg\"\r\nContent-Type: image/jpeg\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
Completed 500 Internal Server Error in 324ms (ActiveRecord: 25.1ms (0 queries, 0 cached) | GC: 0.0ms)


  
Psych::AliasesNotEnabled (Alias parsing was not enabled. To enable it, pass `aliases: true` to `Psych::load` or `Psych::safe_load`.):
  
app/models/document.rb:16:in 'Document#original_file_mime_type'
app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started POST "/documents" for ::1 at 2025-12-28 16:39:40 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x000001d5bd553fe0 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251228-25124-g36oxe.pdf>, @content_type="application/pdf", @original_filename="Busta paga ESEMPIO.pdf", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"Busta paga ESEMPIO.pdf\"\r\nContent-Type: application/pdf\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
Completed 500 Internal Server Error in 229ms (ActiveRecord: 25.6ms (0 queries, 0 cached) | GC: 0.0ms)


  
Psych::AliasesNotEnabled (Alias parsing was not enabled. To enable it, pass `aliases: true` to `Psych::load` or `Psych::safe_load`.):
  
app/models/document.rb:16:in 'Document#original_file_mime_type'
app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started POST "/documents" for 127.0.0.1 at 2025-12-28 16:40:39 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x00000108be7529a8 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251228-24564-zz1bp4.jpg>, @content_type="image/jpeg", @original_filename="BustaPagaDemo.jpg", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"BustaPagaDemo.jpg\"\r\nContent-Type: image/jpeg\r\n">}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Create (1.1ms)[0m  [1m[32mINSERT INTO "documents" ("status", "doc_type", "ai_data", "created_at", "updated_at") VALUES ('pending', NULL, NULL, '2025-12-28 15:40:40.216127', '2025-12-28 15:40:40.216127') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (2.2ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 5 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Create (1.1ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('in32jwvposrc6sqrhlhmoowggc27', 'BustaPagaDemo.jpg', 'image/jpeg', '{"identified":true}', 'local', 254370, 'cfzEjxmf7crYuhdUmXOA+g==', '2025-12-28 15:40:40.248665') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Create (2.0ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('original_file', 'Document', 5, 5, '2025-12-28 15:40:40.258802') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Update (1.0ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 15:40:40.269230' WHERE "documents"."id" = 5 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (8.3ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[36m  Disk Storage (12.6ms) [0m[32mUploaded file to key: in32jwvposrc6sqrhlhmoowggc27 (checksum: cfzEjxmf7crYuhdUmXOA+g==)[0m
[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: 349f5e85-5368-48b0-8616-1e40285d804d) to Async(default) with arguments: #<GlobalID:0x00000108bc31aec8 @uri=#<URI::GID gid://nexum-poc/ActiveStorage::Blob/5>>
[ActiveJob] â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[ActiveJob] Enqueued AnalyzeDocumentJob (Job ID: 7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28) to Async(default) with arguments: 5
[ActiveJob] â†³ app/controllers/documents_controller.rb:11:in 'DocumentsController#create'
Completed 201 Created in 404ms (Views: 0.3ms | ActiveRecord: 40.9ms (5 queries, 0 cached) | GC: 0.3ms)


[ActiveJob] [ActiveStorage::AnalyzeJob] [349f5e85-5368-48b0-8616-1e40285d804d]   [1m[36mActiveStorage::Blob Load (0.4ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 5 LIMIT 1 /*application='NexumPoc'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [349f5e85-5368-48b0-8616-1e40285d804d] Performing ActiveStorage::AnalyzeJob (Job ID: 349f5e85-5368-48b0-8616-1e40285d804d) from Async(default) enqueued at 2025-12-28T15:40:40.362009000Z with arguments: #<GlobalID:0x00000108baa0f2a8 @uri=#<URI::GID gid://nexum-poc/ActiveStorage::Blob/5>>
[ActiveJob] [ActiveStorage::AnalyzeJob] [349f5e85-5368-48b0-8616-1e40285d804d] Skipping image analysis because the ruby-vips gem isn't installed
[ActiveJob] [ActiveStorage::AnalyzeJob] [349f5e85-5368-48b0-8616-1e40285d804d]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [349f5e85-5368-48b0-8616-1e40285d804d]   [1m[36mActiveStorage::Blob Update (6.5ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 5 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28] Performing AnalyzeDocumentJob (Job ID: 7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28) from Async(default) enqueued at 2025-12-28T15:40:40.382576800Z with arguments: 5
[ActiveJob] [ActiveStorage::AnalyzeJob] [349f5e85-5368-48b0-8616-1e40285d804d]   [1m[36mActiveStorage::Attachment Load (4.6ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 5 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [349f5e85-5368-48b0-8616-1e40285d804d]   [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 5 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [349f5e85-5368-48b0-8616-1e40285d804d]   [1m[36mDocument Update (0.4ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 15:40:40.459968' WHERE "documents"."id" = 5 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [349f5e85-5368-48b0-8616-1e40285d804d]   [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [349f5e85-5368-48b0-8616-1e40285d804d] Performed ActiveStorage::AnalyzeJob (Job ID: 349f5e85-5368-48b0-8616-1e40285d804d) from Async(default) in 55.97ms
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   [1m[36mDocument Load (102.9ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 5 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   â†³ app/jobs/analyze_document_job.rb:6:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   [1m[36mActiveStorage::Attachment Load (2.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 5 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   [1m[36mActiveStorage::Blob Load (2.0ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 5 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   â†³ app/models/document.rb:17:in 'Document#original_file_mime_type'
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   [1m[36mDocument Update (0.5ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'processing', "updated_at" = '2025-12-28 15:40:40.560986' WHERE "documents"."id" = 5 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28] [36m  Disk Storage (0.7ms) [0m[34mDownloaded file from key: in32jwvposrc6sqrhlhmoowggc27[0m
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28] Document analysis error: Bedrock error: The security token included in the request is expired
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   â†³ app/jobs/analyze_document_job.rb:21:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   [1m[36mDocument Update (3.9ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'failed', "ai_data" = '{"error":"Bedrock error: The security token included in the request is expired"}', "updated_at" = '2025-12-28 15:40:41.833285' WHERE "documents"."id" = 5 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   â†³ app/jobs/analyze_document_job.rb:21:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28]   â†³ app/jobs/analyze_document_job.rb:21:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28] Performed AnalyzeDocumentJob (Job ID: 7f11cd92-db3c-4b50-99ce-0f2a7d6c0a28) from Async(default) in 1409.32ms
Started GET "/documents/5" for 127.0.0.1 at 2025-12-28 16:40:42 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "5"}
  [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 5 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started POST "/documents" for ::1 at 2025-12-28 16:41:27 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x0000025ef86a3340 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251228-25332-474htq.jpg>, @content_type="image/jpeg", @original_filename="BustaPagaDemo.jpg", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"BustaPagaDemo.jpg\"\r\nContent-Type: image/jpeg\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Create (1.0ms)[0m  [1m[32mINSERT INTO "documents" ("status", "doc_type", "ai_data", "created_at", "updated_at") VALUES ('pending', NULL, NULL, '2025-12-28 15:41:28.084793', '2025-12-28 15:41:28.084793') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (2.5ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 6 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Create (1.3ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('tot6ql4bnkpb72rp71llnhviywpj', 'BustaPagaDemo.jpg', 'image/jpeg', '{"identified":true}', 'local', 254370, 'cfzEjxmf7crYuhdUmXOA+g==', '2025-12-28 15:41:28.125434') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Create (1.8ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('original_file', 'Document', 6, 6, '2025-12-28 15:41:28.135533') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Update (1.1ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 15:41:28.147865' WHERE "documents"."id" = 6 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[36m  Disk Storage (13.0ms) [0m[32mUploaded file to key: tot6ql4bnkpb72rp71llnhviywpj (checksum: cfzEjxmf7crYuhdUmXOA+g==)[0m
[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: cd5e0e15-e5ae-46ee-9f88-af39279af608) to Async(default) with arguments: #<GlobalID:0x0000025ef3889b50 @uri=#<URI::GID gid://nexum-poc/ActiveStorage::Blob/6>>
[ActiveJob] â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[ActiveJob] Enqueued AnalyzeDocumentJob (Job ID: 19dc3e44-e326-4b65-87ae-f888cc1fad86) to Async(default) with arguments: 6
[ActiveJob] â†³ app/controllers/documents_controller.rb:11:in 'DocumentsController#create'
Completed 201 Created in 396ms (Views: 0.3ms | ActiveRecord: 35.5ms (5 queries, 0 cached) | GC: 0.5ms)


[ActiveJob] [ActiveStorage::AnalyzeJob] [cd5e0e15-e5ae-46ee-9f88-af39279af608]   [1m[36mActiveStorage::Blob Load (0.4ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 6 LIMIT 1 /*application='NexumPoc'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [cd5e0e15-e5ae-46ee-9f88-af39279af608] Performing ActiveStorage::AnalyzeJob (Job ID: cd5e0e15-e5ae-46ee-9f88-af39279af608) from Async(default) enqueued at 2025-12-28T15:41:28.239628900Z with arguments: #<GlobalID:0x0000025ef44ab7a8 @uri=#<URI::GID gid://nexum-poc/ActiveStorage::Blob/6>>
[ActiveJob] [ActiveStorage::AnalyzeJob] [cd5e0e15-e5ae-46ee-9f88-af39279af608] Skipping image analysis because the ruby-vips gem isn't installed
[ActiveJob] [ActiveStorage::AnalyzeJob] [cd5e0e15-e5ae-46ee-9f88-af39279af608]   [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [cd5e0e15-e5ae-46ee-9f88-af39279af608]   [1m[36mActiveStorage::Blob Update (5.1ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 6 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86] Performing AnalyzeDocumentJob (Job ID: 19dc3e44-e326-4b65-87ae-f888cc1fad86) from Async(default) enqueued at 2025-12-28T15:41:28.247103500Z with arguments: 6
[ActiveJob] [ActiveStorage::AnalyzeJob] [cd5e0e15-e5ae-46ee-9f88-af39279af608]   [1m[36mActiveStorage::Attachment Load (4.3ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 6 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [cd5e0e15-e5ae-46ee-9f88-af39279af608]   [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 6 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [cd5e0e15-e5ae-46ee-9f88-af39279af608]   [1m[36mDocument Update (0.4ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 15:41:28.324364' WHERE "documents"."id" = 6 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [cd5e0e15-e5ae-46ee-9f88-af39279af608]   [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [cd5e0e15-e5ae-46ee-9f88-af39279af608] Performed ActiveStorage::AnalyzeJob (Job ID: cd5e0e15-e5ae-46ee-9f88-af39279af608) from Async(default) in 54.77ms
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   [1m[36mDocument Load (127.6ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 6 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   â†³ app/jobs/analyze_document_job.rb:6:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   [1m[36mActiveStorage::Attachment Load (2.3ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 6 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   [1m[36mActiveStorage::Blob Load (1.7ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 6 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   â†³ app/models/document.rb:17:in 'Document#original_file_mime_type'
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   [1m[36mDocument Update (0.6ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'processing', "updated_at" = '2025-12-28 15:41:28.449095' WHERE "documents"."id" = 6 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86] [36m  Disk Storage (0.4ms) [0m[34mDownloaded file from key: tot6ql4bnkpb72rp71llnhviywpj[0m
Started GET "/documents/6" for ::1 at 2025-12-28 16:41:30 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "6"}
  [1m[36mDocument Load (0.5ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 6 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   [1m[36mDocument Update (3.9ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'completed', "doc_type" = 'Cedolino', "ai_data" = '{"tipo_documento":"Cedolino","data_competenza":"08/05/2017","codice_fiscale":"7862","dipendente":"LAZONE E UNIVERISITA'' 2017"}', "updated_at" = '2025-12-28 15:41:30.745121' WHERE "documents"."id" = 6 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [19dc3e44-e326-4b65-87ae-f888cc1fad86] Performed AnalyzeDocumentJob (Job ID: 19dc3e44-e326-4b65-87ae-f888cc1fad86) from Async(default) in 2456.37ms
Started GET "/documents/6" for ::1 at 2025-12-28 16:41:32 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "6"}
  [1m[36mDocument Load (0.6ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 6 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms (1 query, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started POST "/documents" for ::1 at 2025-12-28 16:56:46 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x0000019c5e9420e0 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251228-21248-f4ck1a.jpg>, @content_type="image/jpeg", @original_filename="BustaPagaDemo.jpg", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"BustaPagaDemo.jpg\"\r\nContent-Type: image/jpeg\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Create (1.4ms)[0m  [1m[32mINSERT INTO "documents" ("status", "doc_type", "ai_data", "created_at", "updated_at") VALUES ('pending', NULL, NULL, '2025-12-28 15:56:47.332372', '2025-12-28 15:56:47.332372') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (2.3ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 7 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Create (1.0ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('a40tbjke0ni7d40lzij7prls40w0', 'BustaPagaDemo.jpg', 'image/jpeg', '{"identified":true}', 'local', 254370, 'cfzEjxmf7crYuhdUmXOA+g==', '2025-12-28 15:56:47.369304') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Create (1.4ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('original_file', 'Document', 7, 7, '2025-12-28 15:56:47.378091') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Update (1.0ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 15:56:47.387590' WHERE "documents"."id" = 7 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (3.0ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[36m  Disk Storage (11.4ms) [0m[32mUploaded file to key: a40tbjke0ni7d40lzij7prls40w0 (checksum: cfzEjxmf7crYuhdUmXOA+g==)[0m
[ActiveJob] Enqueued ActiveStorage::AnalyzeJob (Job ID: aa9b7f31-1860-4069-a1cd-5d6a724a736d) to Async(default) with arguments: #<GlobalID:0x0000019c5c57c520 @uri=#<URI::GID gid://nexum-poc/ActiveStorage::Blob/7>>
[ActiveJob] â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[ActiveJob] Enqueued AnalyzeDocumentJob (Job ID: 298309cc-8bd2-4d11-8113-3dafd2e4acb3) to Async(default) with arguments: 7
[ActiveJob] â†³ app/controllers/documents_controller.rb:11:in 'DocumentsController#create'
Completed 201 Created in 406ms (Views: 0.2ms | ActiveRecord: 40.4ms (5 queries, 0 cached) | GC: 990.5ms)


[ActiveJob] [ActiveStorage::AnalyzeJob] [aa9b7f31-1860-4069-a1cd-5d6a724a736d]   [1m[36mActiveStorage::Blob Load (0.5ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 7 LIMIT 1 /*application='NexumPoc'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [aa9b7f31-1860-4069-a1cd-5d6a724a736d] Performing ActiveStorage::AnalyzeJob (Job ID: aa9b7f31-1860-4069-a1cd-5d6a724a736d) from Async(default) enqueued at 2025-12-28T15:56:47.476221300Z with arguments: #<GlobalID:0x0000019c5ace16a0 @uri=#<URI::GID gid://nexum-poc/ActiveStorage::Blob/7>>
[ActiveJob] [ActiveStorage::AnalyzeJob] [aa9b7f31-1860-4069-a1cd-5d6a724a736d] Skipping image analysis because the ruby-vips gem isn't installed
[ActiveJob] [ActiveStorage::AnalyzeJob] [aa9b7f31-1860-4069-a1cd-5d6a724a736d]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [aa9b7f31-1860-4069-a1cd-5d6a724a736d]   [1m[36mActiveStorage::Blob Update (5.9ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 7 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3] Performing AnalyzeDocumentJob (Job ID: 298309cc-8bd2-4d11-8113-3dafd2e4acb3) from Async(default) enqueued at 2025-12-28T15:56:47.489607000Z with arguments: 7
[ActiveJob] [ActiveStorage::AnalyzeJob] [aa9b7f31-1860-4069-a1cd-5d6a724a736d]   [1m[36mActiveStorage::Attachment Load (4.7ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 7 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [aa9b7f31-1860-4069-a1cd-5d6a724a736d]   [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 7 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [aa9b7f31-1860-4069-a1cd-5d6a724a736d]   [1m[36mDocument Update (0.3ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 15:56:47.573597' WHERE "documents"."id" = 7 /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [aa9b7f31-1860-4069-a1cd-5d6a724a736d]   [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='ActiveStorage%3A%3AAnalyzeJob'*/[0m
[ActiveJob] [ActiveStorage::AnalyzeJob] [aa9b7f31-1860-4069-a1cd-5d6a724a736d] Performed ActiveStorage::AnalyzeJob (Job ID: aa9b7f31-1860-4069-a1cd-5d6a724a736d) from Async(default) in 55.12ms
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   [1m[36mDocument Load (103.2ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 7 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   â†³ app/jobs/analyze_document_job.rb:6:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   [1m[36mActiveStorage::Attachment Load (2.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 7 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   [1m[36mActiveStorage::Blob Load (1.8ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 7 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   â†³ app/models/document.rb:17:in 'Document#original_file_mime_type'
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   [1m[36mDocument Update (0.5ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'processing', "updated_at" = '2025-12-28 15:56:47.675738' WHERE "documents"."id" = 7 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3] [36m  Disk Storage (0.4ms) [0m[34mDownloaded file from key: a40tbjke0ni7d40lzij7prls40w0[0m
Started GET "/documents/7" for ::1 at 2025-12-28 16:56:49 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "7"}
  [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 7 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   [1m[36mDocument Update (3.7ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'completed', "doc_type" = 'Cedolino', "ai_data" = '{"tipo_documento":"Cedolino","data_competenza":"08/05/2017","codice_fiscale":"LONNRS80A41D1548V","dipendente":"Gennaio 2017"}', "updated_at" = '2025-12-28 15:56:49.950664' WHERE "documents"."id" = 7 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [298309cc-8bd2-4d11-8113-3dafd2e4acb3] Performed AnalyzeDocumentJob (Job ID: 298309cc-8bd2-4d11-8113-3dafd2e4acb3) from Async(default) in 2411.46ms
Started GET "/documents/7" for ::1 at 2025-12-28 16:56:51 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "7"}
  [1m[36mDocument Load (0.5ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 7 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-28 16:56:59 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-28 16:56:59 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mConversation Load (4.6ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 30ms (Views: 0.1ms | ActiveRecord: 17.1ms (1 query, 0 cached) | GC: 0.0ms)


  [1m[36mTone Load (1.9ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 41ms (Views: 6.4ms | ActiveRecord: 12.9ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-28 16:57:11 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto asciugacapelli silenzioso.", "tone" => "Istituzionale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto asciugacapelli silenzioso.", "tone" => "Istituzionale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:39:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:177:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (6.0ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-28 15:57:11.168373', NULL, NULL, '2025-12-28 15:57:11.168373') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:177:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:177:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:42:in 'AiService#genera'
  [1m[36mMessage Load (2.8ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 3 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:49:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mMessage Create (7.6ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un''email di presentazione del prodotto asciugacapelli silenzioso.', 3, '2025-12-28 15:57:13.461486', 'user', '2025-12-28 15:57:13.461486') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mMessage Create (4.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Scopri il nostro asciugacapelli silenzioso: rivoluzione nella cura dei capelli

Gentile Partner,

Vi presentiamo il nostro ultimo arrivo: l''asciugacapelli silenzioso, progettato per offrire prestazioni eccezionali senza il fastidio del rumore. Questo prodotto Ã¨ ideale per i clienti che cercano un''esperienza di asciugatura efficace e confortevole.

Caratteristiche principali:
- Tecnologia a bassa rumorositÃ  per un''esperienza di asciugatura silenziosa
- Flusso d''aria potente e uniforme per asciugature rapide
- Design ergonomico per un uso prolungato senza fatica
- Materiali di alta qualitÃ  per una durata prolungata

Siamo sicuri che questo asciugacapelli farÃ  un''ottima impressione e soddisferÃ  le esigenze dei vostri clienti. Vi invitiamo a esplorare le opportunitÃ  di partnership con noi.

Cordiali saluti,
[Il tuo nome]
[Il tuo ruolo]
Acme', 3, '2025-12-28 15:57:13.476313', 'assistant', '2025-12-28 15:57:13.476313') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
Completed 200 OK in 2468ms (Views: 0.2ms | ActiveRecord: 24.8ms (6 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-28 16:57:13 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-28 16:57:28 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "togli ste parentesi", "tone" => "Istituzionale", "company_id" => 1, "conversation_id" => 3, "generator" => {"prompt" => "togli ste parentesi", "tone" => "Istituzionale", "company_id" => 1, "conversation_id" => 3}}
  [1m[36mCompany Load (0.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:39:in 'AiService#genera'
  [1m[36mConversation Load (0.3ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 3 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:176:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:42:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 3 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:49:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mMessage Create (4.4ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('togli ste parentesi', 3, '2025-12-28 15:57:29.635102', 'user', '2025-12-28 15:57:29.635102') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (1.7ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mMessage Create (4.6ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Scopri il nostro asciugacapelli silenzioso: rivoluzione nella cura dei capelli

Gentile Partner,

Vi presentiamo il nostro ultimo arrivo: l''asciugacapelli silenzioso, progettato per offrire prestazioni eccezionali senza il fastidio del rumore. Questo prodotto Ã¨ ideale per i clienti che cercano un''esperienza di asciugatura efficace e confortevole.

Caratteristiche principali:
- Tecnologia a bassa rumorositÃ  per un''esperienza di asciugatura silenziosa
- Flusso d''aria potente e uniforme per asciugature rapide
- Design ergonomico per un uso prolungato senza fatica
- Materiali di alta qualitÃ  per una durata prolungata

Siamo sicuri che questo asciugacapelli farÃ  un''ottima impressione e soddisferÃ  le esigenze dei vostri clienti. Vi invitiamo a esplorare le opportunitÃ  di partnership con noi.

Cordiali saluti,
[Il tuo nome]
[Il tuo ruolo]
Acme', 3, '2025-12-28 15:57:29.647801', 'assistant', '2025-12-28 15:57:29.647801') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
Completed 200 OK in 1363ms (Views: 0.1ms | ActiveRecord: 12.9ms (6 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-28 16:57:49 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Togli le parentesi quadre ", "tone" => "Istituzionale", "company_id" => 1, "conversation_id" => 3, "generator" => {"prompt" => "Togli le parentesi quadre ", "tone" => "Istituzionale", "company_id" => 1, "conversation_id" => 3}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:39:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 3 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:176:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:42:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 3 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:49:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mMessage Create (4.2ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Togli le parentesi quadre ', 3, '2025-12-28 15:57:50.739526', 'user', '2025-12-28 15:57:50.739526') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (8.2ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mMessage Create (4.5ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Scopri il nostro asciugacapelli silenzioso: rivoluzione nella cura dei capelli

Gentile Partner,

Vi presentiamo il nostro ultimo arrivo: l''asciugacapelli silenzioso, progettato per offrire prestazioni eccezionali senza il fastidio del rumore. Questo prodotto Ã¨ ideale per i clienti che cercano un''esperienza di asciugatura efficace e confortevole.

Caratteristiche principali:
- Tecnologia a bassa rumorositÃ  per un''esperienza di asciugatura silenziosa
- Flusso d''aria potente e uniforme per asciugature rapide
- Design ergonomico per un uso prolungato senza fatica
- Materiali di alta qualitÃ  per una durata prolungata

Siamo sicuri che questo asciugacapelli farÃ  un''ottima impressione e soddisferÃ  le esigenze dei vostri clienti. Vi invitiamo a esplorare le opportunitÃ  di partnership con noi.

Cordiali saluti,
Il tuo nome
Il tuo ruolo
Acme', 3, '2025-12-28 15:57:50.758313', 'assistant', '2025-12-28 15:57:50.758313') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
Completed 200 OK in 1667ms (Views: 0.1ms | ActiveRecord: 19.3ms (6 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-28 16:57:59 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "fallo corto", "tone" => "Istituzionale", "company_id" => 1, "conversation_id" => 3, "generator" => {"prompt" => "fallo corto", "tone" => "Istituzionale", "company_id" => 1, "conversation_id" => 3}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:39:in 'AiService#genera'
  [1m[36mConversation Load (0.3ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 3 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:176:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:42:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 3 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:49:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mMessage Create (3.8ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('fallo corto', 3, '2025-12-28 15:58:00.770953', 'user', '2025-12-28 15:58:00.770953') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mMessage Create (4.1ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Scopri il nostro asciugacapelli silenzioso

Gentile Partner,

Vi presentiamo il nostro asciugacapelli silenzioso, progettato per un''asciugatura efficace e silenziosa. Ideale per i clienti che cercano comfort.

Caratteristiche principali:
- Tecnologia a bassa rumorositÃ 
- Flusso d''aria potente
- Design ergonomico
- Materiali di alta qualitÃ 

Vi invitiamo a esplorare le opportunitÃ  di partnership con noi.

Cordiali saluti,
Il tuo nome
Il tuo ruolo
Acme', 3, '2025-12-28 15:58:00.781759', 'assistant', '2025-12-28 15:58:00.781759') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
Completed 200 OK in 1266ms (Views: 0.1ms | ActiveRecord: 10.7ms (6 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-28 16:58:06 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "senza oggetto", "tone" => "Istituzionale", "company_id" => 1, "conversation_id" => 3, "generator" => {"prompt" => "senza oggetto", "tone" => "Istituzionale", "company_id" => 1, "conversation_id" => 3}}
  [1m[36mCompany Load (0.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:39:in 'AiService#genera'
  [1m[36mConversation Load (0.3ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 3 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:176:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:42:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 3 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:49:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mMessage Create (4.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('senza oggetto', 3, '2025-12-28 15:58:07.677869', 'user', '2025-12-28 15:58:07.677869') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (8.8ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mMessage Create (4.2ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Gentile Partner,

Vi presentiamo il nostro asciugacapelli silenzioso, progettato per un''asciugatura efficace e silenziosa. Ideale per i clienti che cercano comfort.

Caratteristiche principali:
- Tecnologia a bassa rumorositÃ 
- Flusso d''aria potente
- Design ergonomico
- Materiali di alta qualitÃ 

Vi invitiamo a esplorare le opportunitÃ  di partnership con noi.

Cordiali saluti,
Il tuo nome
Il tuo ruolo
Acme', 3, '2025-12-28 15:58:07.697596', 'assistant', '2025-12-28 15:58:07.697596') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
Completed 200 OK in 1266ms (Views: 0.2ms | ActiveRecord: 19.7ms (6 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/toni?company_id=1" for ::1 at 2025-12-28 17:25:21 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-28 17:25:21 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.6ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (2.2ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 198ms (Views: 6.5ms | ActiveRecord: 22.7ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-28 17:25:22 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (1.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 13ms (Views: 0.1ms | ActiveRecord: 3.2ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=0" for ::1 at 2025-12-28 17:25:35 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "0"}
  [1m[36mCompany Load (0.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 0 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/toni?company_id=1" for ::1 at 2025-12-28 17:25:38 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 7ms (Views: 3.3ms | ActiveRecord: 0.7ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-28 17:26:18 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "comunica che l'azienda andrÃ¡ in ferie dal 20 al 30 di gennaio", "tone" => "Formale", "company_id" => 1, "generator" => {"prompt" => "comunica che l'azienda andrÃ¡ in ferie dal 20 al 30 di gennaio", "tone" => "Formale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:39:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:177:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.7ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-28 16:26:19.063052', NULL, NULL, '2025-12-28 16:26:19.063052') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:177:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (9.2ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:177:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.5ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:42:in 'AiService#genera'
  [1m[36mMessage Load (2.8ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 4 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:49:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mMessage Create (4.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('comunica che l''azienda andrÃ¡ in ferie dal 20 al 30 di gennaio', 4, '2025-12-28 16:26:20.394638', 'user', '2025-12-28 16:26:20.394638') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mMessage Create (4.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Gentile Cliente,

Vi informiamo che la nostra azienda sarÃ  chiusa per ferie dal 20 al 30 gennaio. Durante questo periodo, non saremo disponibili per rispondere a richieste o fornire supporto. Risponderemo a tutte le email e telefonate al nostro ritorno, il 31 gennaio.

Grazie per la vostra comprensione.

Cordiali saluti,
Team Acme', 4, '2025-12-28 16:26:20.406526', 'assistant', '2025-12-28 16:26:20.406526') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
Completed 200 OK in 1667ms (Views: 0.2ms | ActiveRecord: 30.3ms (6 queries, 0 cached) | GC: 0.2ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-28 17:26:20 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-28 17:26:30 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "fallo piÃº corto \n", "tone" => "Formale", "company_id" => 1, "conversation_id" => 4, "generator" => {"prompt" => "fallo piÃº corto \n", "tone" => "Formale", "company_id" => 1, "conversation_id" => 4}}
  [1m[36mCompany Load (0.3ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:39:in 'AiService#genera'
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 4 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:176:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:42:in 'AiService#genera'
  [1m[36mMessage Load (0.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 4 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:49:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mMessage Create (3.9ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('fallo piÃº corto 
', 4, '2025-12-28 16:26:31.093886', 'user', '2025-12-28 16:26:31.093886') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (7.8ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mMessage Create (4.2ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Gentile Cliente,

La nostra azienda sarÃ  chiusa per ferie dal 20 al 30 gennaio. Non saremo disponibili per richieste o supporto in questo periodo. Risponderemo a tutte le email e telefonate dal 31 gennaio.

Grazie per la vostra comprensione.

Cordiali saluti,
Team Acme', 4, '2025-12-28 16:26:31.112651', 'assistant', '2025-12-28 16:26:31.112651') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
Completed 200 OK in 1062ms (Views: 0.1ms | ActiveRecord: 18.1ms (6 queries, 0 cached) | GC: 0.0ms)


Started POST "/documents" for ::1 at 2025-12-28 17:26:59 +0100
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x0000021cee7dbba0 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251228-12496-56b1ug.pdf>, @content_type="application/pdf", @original_filename="Busta paga ESEMPIO.pdf", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"Busta paga ESEMPIO.pdf\"\r\nContent-Type: application/pdf\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Create (1.0ms)[0m  [1m[32mINSERT INTO "documents" ("status", "doc_type", "ai_data", "created_at", "updated_at") VALUES ('pending', NULL, NULL, '2025-12-28 16:26:59.961133', '2025-12-28 16:26:59.961133') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (2.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 8 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Create (0.9ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('2q8520xpk81q3g2qf8v57za7dahh', 'Busta paga ESEMPIO.pdf', 'application/pdf', '{"identified":true}', 'local', 85189, 'JATuvF8vQO1Ak66jZ7GYAA==', '2025-12-28 16:26:59.972084') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Create (1.4ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('original_file', 'Document', 8, 8, '2025-12-28 16:26:59.978593') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Update (1.0ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 16:26:59.984529' WHERE "documents"."id" = 8 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[36m  Disk Storage (11.9ms) [0m[32mUploaded file to key: 2q8520xpk81q3g2qf8v57za7dahh (checksum: JATuvF8vQO1Ak66jZ7GYAA==)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Update (5.7ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 8 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.3ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 8 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Load (0.3ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 8 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Update (0.3ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-28 16:27:00.036564' WHERE "documents"."id" = 8 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 8 AND "active_storage_attachments"."record_type" = 'ActiveStorage::Blob' AND "active_storage_attachments"."name" = 'preview_image' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[ActiveJob] Enqueued AnalyzeDocumentJob (Job ID: e2de5e28-f905-4793-9c09-ceb6ca2c8b86) to Async(default) with arguments: 8
[ActiveJob] â†³ app/controllers/documents_controller.rb:11:in 'DocumentsController#create'
Completed 201 Created in 611ms (Views: 0.1ms | ActiveRecord: 22.3ms (10 queries, 0 cached) | GC: 0.2ms)


[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86] Performing AnalyzeDocumentJob (Job ID: e2de5e28-f905-4793-9c09-ceb6ca2c8b86) from Async(default) enqueued at 2025-12-28T16:27:00.486832800Z with arguments: 8
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 8 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   â†³ app/jobs/analyze_document_job.rb:6:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   [1m[36mActiveStorage::Attachment Load (5.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 8 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   [1m[36mActiveStorage::Blob Load (0.3ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 8 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   â†³ app/models/document.rb:17:in 'Document#original_file_mime_type'
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   [1m[36mDocument Update (0.3ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'processing', "updated_at" = '2025-12-28 16:27:00.526655' WHERE "documents"."id" = 8 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86] [36m  Disk Storage (0.5ms) [0m[34mDownloaded file from key: 2q8520xpk81q3g2qf8v57za7dahh[0m
Started GET "/documents/8" for ::1 at 2025-12-28 17:27:02 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "8"}
  [1m[36mDocument Load (0.5ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 8 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/documents/8" for ::1 at 2025-12-28 17:27:04 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "8"}
  [1m[36mDocument Load (0.5ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 8 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/documents/8" for ::1 at 2025-12-28 17:27:06 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "8"}
  [1m[36mDocument Load (0.5ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 8 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   [1m[36mDocument Update (3.8ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'completed', "doc_type" = 'Cedolino', "ai_data" = '{"tipo_documento":"Cedolino","data_competenza":"08/05/2017","codice_fiscale":"FERRA (FE)","dipendente":"FERRA (FE)"}', "updated_at" = '2025-12-28 16:27:07.250008' WHERE "documents"."id" = 8 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [e2de5e28-f905-4793-9c09-ceb6ca2c8b86] Performed AnalyzeDocumentJob (Job ID: e2de5e28-f905-4793-9c09-ceb6ca2c8b86) from Async(default) in 6755.12ms
Started GET "/documents/8" for ::1 at 2025-12-28 17:27:08 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "8"}
  [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 8 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
  [1m[36mActiveRecord::SchemaMigration Load (5.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  [1m[36mCACHE ActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Started GET "/favicon.ico" for 127.0.0.1 at 2025-12-29 11:11:49 +0100
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-29 11:11:49 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-29 11:11:49 +0100
  [1m[36mActiveRecord::SchemaMigration Load (3.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/toni"):
  
  
ActionController::RoutingError (No route matches [GET] "/favicon.ico"):
  
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
Started GET "/toni?company_id=1" for ::1 at 2025-12-29 11:11:50 +0100
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (2.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mConversation Load (9.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 853ms (Views: 0.2ms | ActiveRecord: 81.8ms (1 query, 0 cached) | GC: 0.2ms)


  [1m[36mTone Load (4.9ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 727ms (Views: 6.0ms | ActiveRecord: 205.2ms (2 queries, 0 cached) | GC: 0.2ms)


Started POST "/genera" for ::1 at 2025-12-29 11:12:09 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Formale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto.", "tone" => "Formale", "company_id" => 1}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:39:in 'AiService#genera'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:177:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (16.9ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-29 10:12:32.050247', NULL, NULL, '2025-12-29 10:12:32.050247') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:177:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:177:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.9ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Formale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:42:in 'AiService#genera'
  [1m[36mMessage Load (4.6ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 5 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:49:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
Errore interno: Aws::Errors::MissingCredentialsError - unable to sign request without credentials set
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/sign.rb:122:in 'Aws::Plugins::Sign::SignatureV4#initialize'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/sign.rb:30:in 'Class#new'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/sign.rb:30:in 'Aws::Plugins::Sign.signer_for'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/sign.rb:42:in 'Aws::Plugins::Sign::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/transfer_encoding.rb:27:in 'Aws::Plugins::TransferEncoding::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/helpful_socket_errors.rb:12:in 'Aws::Plugins::HelpfulSocketErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/retry_errors.rb:365:in 'block in Aws::Plugins::RetryErrors::LegacyHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/user_agent.rb:92:in 'Aws::Plugins::UserAgent.metric'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/retry_errors.rb:385:in 'Aws::Plugins::RetryErrors::LegacyHandler#with_metric'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/retry_errors.rb:365:in 'Aws::Plugins::RetryErrors::LegacyHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/http_checksum.rb:20:in 'Aws::Plugins::HttpChecksum::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/endpoint_pattern.rb:45:in 'Aws::Plugins::EndpointPattern::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:201:in 'block in Aws::Plugins::ChecksumAlgorithm::ChecksumHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/user_agent.rb:92:in 'Aws::Plugins::UserAgent.metric'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:211:in 'Aws::Plugins::ChecksumAlgorithm::ChecksumHandler#with_metrics'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:201:in 'Aws::Plugins::ChecksumAlgorithm::ChecksumHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/request_compression.rb:94:in 'block in Aws::Plugins::RequestCompression::CompressionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/request_compression.rb:104:in 'Aws::Plugins::RequestCompression::CompressionHandler#with_metric'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/request_compression.rb:94:in 'Aws::Plugins::RequestCompression::CompressionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/rest/content_type_handler.rb:27:in 'Aws::Rest::ContentTypeHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/rest/handler.rb:10:in 'Aws::Rest::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/recursion_detection.rb:18:in 'Aws::Plugins::RecursionDetection::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/plugins/bearer_authorization.rb:19:in 'Aws::BedrockRuntime::Plugins::BearerAuthorization::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/plugins/endpoints.rb:43:in 'block in Aws::BedrockRuntime::Plugins::Endpoints::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/user_agent.rb:92:in 'Aws::Plugins::UserAgent.metric'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/plugins/endpoints.rb:57:in 'Aws::BedrockRuntime::Plugins::Endpoints::Handler#with_metrics'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/plugins/endpoints.rb:43:in 'Aws::BedrockRuntime::Plugins::Endpoints::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/endpoint_discovery.rb:84:in 'Aws::Plugins::EndpointDiscovery::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/endpoint.rb:46:in 'Seahorse::Client::Plugins::Endpoint::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_validator.rb:26:in 'Aws::Plugins::ParamValidator::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/raise_response_errors.rb:16:in 'Seahorse::Client::Plugins::RaiseResponseErrors::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/checksum_algorithm.rb:169:in 'Aws::Plugins::ChecksumAlgorithm::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/jsonvalue_converter.rb:16:in 'Aws::Plugins::JsonvalueConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/invocation_id.rb:16:in 'Aws::Plugins::InvocationId::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/idempotency_token.rb:19:in 'Aws::Plugins::IdempotencyToken::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/param_converter.rb:26:in 'Aws::Plugins::ParamConverter::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/request_callback.rb:89:in 'Seahorse::Client::Plugins::RequestCallback::OptionHandler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/response_paging.rb:12:in 'Aws::Plugins::ResponsePaging::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/plugins/response_target.rb:24:in 'Seahorse::Client::Plugins::ResponseTarget::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'block in Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/telemetry/no_op.rb:29:in 'Aws::Telemetry::NoOpTracer#in_span'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:53:in 'Aws::Plugins::Telemetry::Handler#span_wrapper'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/aws-sdk-core/plugins/telemetry.rb:39:in 'Aws::Plugins::Telemetry::Handler#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-core-3.240.0/lib/seahorse/client/request.rb:72:in 'Seahorse::Client::Request#send_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/aws-sdk-bedrockruntime-1.68.0/lib/aws-sdk-bedrockruntime/client.rb:1690:in 'Aws::BedrockRuntime::Client#converse'
C:/Users/marco/Desktop/nexum_poc/backend/app/services/ai_service.rb:93:in 'AiService#converse_with_model'
C:/Users/marco/Desktop/nexum_poc/backend/app/services/ai_service.rb:78:in 'AiService#invoke_bedrock_with_fallback'
C:/Users/marco/Desktop/nexum_poc/backend/app/services/ai_service.rb:62:in 'AiService#genera'
C:/Users/marco/Desktop/nexum_poc/backend/app/controllers/generator_controller.rb:13:in 'GeneratorController#create'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/basic_implicit_render.rb:8:in 'ActionController::BasicImplicitRender#send_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:221:in 'AbstractController::Base#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rendering.rb:199:in 'ActionController::Rendering#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:267:in 'block in AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/callbacks.rb:266:in 'AbstractController::Callbacks#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/rescue.rb:36:in 'ActionController::Rescue#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:76:in 'block in ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'block in ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications/instrumenter.rb:58:in 'ActiveSupport::Notifications::Instrumenter#instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/notifications.rb:210:in 'ActiveSupport::Notifications.instrument'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/instrumentation.rb:75:in 'ActionController::Instrumentation#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal/params_wrapper.rb:259:in 'ActionController::ParamsWrapper#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/railties/controller_runtime.rb:39:in 'ActiveRecord::Railties::ControllerRuntime#process_action'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/abstract_controller/base.rb:154:in 'AbstractController::Base#process'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:252:in 'ActionController::Metal#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_controller/metal.rb:335:in 'ActionController::Metal.dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:65:in 'ActionDispatch::Routing::RouteSet::Dispatcher#dispatch'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:50:in 'ActionDispatch::Routing::RouteSet::Dispatcher#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:35:in 'block in ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:86:in 'block in ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'Array#each'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:66:in 'ActionDispatch::Journey::Router#recognize'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/journey/router.rb:31:in 'ActionDispatch::Journey::Router#serve'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/routing/route_set.rb:906:in 'ActionDispatch::Routing::RouteSet#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/etag.rb:29:in 'Rack::ETag#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/conditional_get.rb:44:in 'Rack::ConditionalGet#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/head.rb:15:in 'Rack::Head#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activerecord-8.1.1/lib/active_record/migration.rb:671:in 'ActiveRecord::Migration::CheckPending#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:31:in 'block in ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/activesupport-8.1.1/lib/active_support/callbacks.rb:101:in 'ActiveSupport::Callbacks#run_callbacks'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/callbacks.rb:30:in 'ActionDispatch::Callbacks#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/actionable_exceptions.rb:18:in 'ActionDispatch::ActionableExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:31:in 'ActionDispatch::DebugExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/show_exceptions.rb:32:in 'ActionDispatch::ShowExceptions#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:41:in 'Rails::Rack::Logger#call_app'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/remote_ip.rb:98:in 'ActionDispatch::RemoteIp#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/request_id.rb:34:in 'ActionDispatch::RequestId#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:61:in 'block in ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:26:in 'ActionDispatch::ServerTiming::Subscriber#collect_events'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/server_timing.rb:60:in 'ActionDispatch::ServerTiming#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/executor.rb:20:in 'ActionDispatch::Executor#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/static.rb:27:in 'ActionDispatch::Static#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/rack-3.2.4/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/actionpack-8.1.1/lib/action_dispatch/middleware/host_authorization.rb:143:in 'ActionDispatch::HostAuthorization#call'
C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/railties-8.1.1/lib/rails/engine.rb:534:in 'Rails::Engine#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/configuration.rb:300:in 'Puma::Configuration::ConfigMiddleware#call'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:101:in 'block in Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/request.rb:100:in 'Puma::Request#handle_request'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
C:/Users/marco/.gem/ruby/3.4.0/gems/puma-7.1.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
Completed 500 Internal Server Error in 22375ms (Views: 0.4ms | ActiveRecord: 27.9ms (4 queries, 0 cached) | GC: 0.0ms)


[dotenv] Set [36mAWS_ACCESS_KEY_ID[0m, [36mAWS_SECRET_ACCESS_KEY[0m, [36mAWS_SESSION_TOKEN[0m
[dotenv] Loaded [33m.env[0m
Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-29 11:14:31 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-29 11:14:31 +0100
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC /*application='NexumPoc'*/[0m
  
ActionController::RoutingError (No route matches [GET] "/conversazioni"):
  
Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (1.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (1.8ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 222ms (Views: 5.7ms | ActiveRecord: 24.8ms (2 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-29 11:14:32 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (2.0ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 13ms (Views: 0.1ms | ActiveRecord: 3.5ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-29 11:14:39 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "Scrivi un'email di presentazione del prodotto carne suina.", "tone" => "Istituzionale", "company_id" => 1, "generator" => {"prompt" => "Scrivi un'email di presentazione del prodotto carne suina.", "tone" => "Istituzionale", "company_id" => 1}}
  [1m[36mCompany Load (0.5ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:39:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:177:in 'AiService#fetch_or_create_conversation'
  [1m[36mConversation Create (5.3ms)[0m  [1m[32mINSERT INTO "conversations" ("company_id", "created_at", "summary", "title", "updated_at") VALUES (1, '2025-12-29 10:14:39.898780', NULL, NULL, '2025-12-29 10:14:39.898780') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:177:in 'AiService#fetch_or_create_conversation'
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:177:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.6ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:42:in 'AiService#genera'
  [1m[36mMessage Load (2.4ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 6 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:49:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mMessage Create (5.2ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Scrivi un''email di presentazione del prodotto carne suina.', 6, '2025-12-29 10:14:41.568276', 'user', '2025-12-29 10:14:41.568276') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mMessage Create (7.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Scopri la QualitÃ  della Nostra Carne Suina

Gentile Partner,

Siamo lieti di presentarvi la nostra eccellente linea di carne suina, selezionata con cura per garantire il massimo della qualitÃ  e del gusto. La nostra carne suina Ã¨ prodotta da allevamenti certificati che seguono rigorosi standard di benessere animale e sostenibilitÃ .

Caratteristiche principali:
- Certificazioni di qualitÃ  e sicurezza alimentare
- VarietÃ  di tagli e preparazioni
- Consegna puntuale e flessibile

Siamo certi che la nostra carne suina soddisferÃ  le vostre esigenze e quelle dei vostri clienti. Vi invitiamo a contattarci per maggiori dettagli e per discutere di partnership commerciali.

Cordiali saluti,
Team Commerciale Acme', 6, '2025-12-29 10:14:41.581300', 'assistant', '2025-12-29 10:14:41.581300') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
Completed 200 OK in 1900ms (Views: 0.1ms | ActiveRecord: 27.5ms (6 queries, 0 cached) | GC: 0.3ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-29 11:14:41 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/genera" for ::1 at 2025-12-29 11:14:49 +0100
Processing by GeneratorController#create as */*
  Parameters: {"prompt" => "falla di 10 parole", "tone" => "Istituzionale", "company_id" => 1, "conversation_id" => 6, "generator" => {"prompt" => "falla di 10 parole", "tone" => "Istituzionale", "company_id" => 1, "conversation_id" => 6}}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:39:in 'AiService#genera'
  [1m[36mConversation Load (0.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 AND "conversations"."id" = 6 LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:176:in 'AiService#fetch_or_create_conversation'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones".* FROM "tones" WHERE "tones"."company_id" = 1 AND "tones"."name" = 'Istituzionale' LIMIT 1 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:42:in 'AiService#genera'
  [1m[36mMessage Load (0.5ms)[0m  [1m[34mSELECT "messages".* FROM "messages" WHERE "messages"."conversation_id" = 6 ORDER BY "messages"."created_at" DESC LIMIT 10 /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:49:in 'AiService#genera'
Bedrock converse â†’ region=us-east-1 model_id=amazon.nova-lite-v1:0
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mMessage Create (4.1ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('falla di 10 parole', 6, '2025-12-29 10:14:50.803675', 'user', '2025-12-29 10:14:50.803675') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:67:in 'AiService#genera'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mMessage Create (4.3ms)[0m  [1m[32mINSERT INTO "messages" ("content", "conversation_id", "created_at", "role", "updated_at") VALUES ('Oggetto: Scopri la QualitÃ  della Nostra Carne Suina

Gentile Partner,

Siamo lieti di presentarvi la nostra eccellente linea di carne suina. Selezionata, certificata, sostenibile. VarietÃ  di tagli. Consegna puntuale. Flessibile. Certificazioni di qualitÃ . Sicurezza alimentare. Contattateci. Partnership commerciali. Cordiali saluti.', 6, '2025-12-29 10:14:50.815580', 'assistant', '2025-12-29 10:14:50.815580') RETURNING "id" /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='generator'*/[0m
  â†³ app/services/ai_service.rb:68:in 'AiService#genera'
Completed 200 OK in 1152ms (Views: 0.1ms | ActiveRecord: 11.8ms (6 queries, 0 cached) | GC: 0.0ms)


Started GET "/conversazioni?company_id=1" for ::1 at 2025-12-29 11:15:15 +0100
Started GET "/toni?company_id=1" for ::1 at 2025-12-29 11:15:15 +0100
Processing by GeneratorController#conversations as */*
  Parameters: {"company_id" => "1"}
  [1m[36mConversation Load (0.4ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."company_id" = 1 ORDER BY "conversations"."updated_at" DESC LIMIT 50 /*action='conversations',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:44:in 'GeneratorController#conversations'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Processing by GeneratorController#index as */*
  Parameters: {"company_id" => "1"}
  [1m[36mCompany Load (0.4ms)[0m  [1m[34mSELECT "companies".* FROM "companies" WHERE "companies"."id" = 1 LIMIT 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:28:in 'GeneratorController#index'
  [1m[36mTone Load (0.4ms)[0m  [1m[34mSELECT "tones"."id", "tones"."name", "tones"."instructions" FROM "tones" WHERE "tones"."company_id" = 1 /*action='index',application='NexumPoc',controller='generator'*/[0m
  â†³ app/controllers/generator_controller.rb:32:in 'GeneratorController#index'
Completed 200 OK in 8ms (Views: 4.2ms | ActiveRecord: 0.8ms (2 queries, 0 cached) | GC: 0.0ms)


Started POST "/documents" for ::1 at 2025-12-29 11:15:26 +0100
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x000002718246e240 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251229-3600-qc5prv.pdf>, @content_type="application/pdf", @original_filename="Busta paga ESEMPIO.pdf", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"Busta paga ESEMPIO.pdf\"\r\nContent-Type: application/pdf\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Create (3.6ms)[0m  [1m[32mINSERT INTO "documents" ("status", "doc_type", "ai_data", "created_at", "updated_at") VALUES ('pending', NULL, NULL, '2025-12-29 10:15:27.223363', '2025-12-29 10:15:27.223363') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (4.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 9 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Create (4.2ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('4c40zukthfnmdvhtuucgbync4vlb', 'Busta paga ESEMPIO.pdf', 'application/pdf', '{"identified":true}', 'local', 85189, 'JATuvF8vQO1Ak66jZ7GYAA==', '2025-12-29 10:15:27.239886') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Create (2.1ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('original_file', 'Document', 9, 9, '2025-12-29 10:15:27.250199') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Update (4.2ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-29 10:15:27.257203' WHERE "documents"."id" = 9 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[36m  Disk Storage (14.0ms) [0m[32mUploaded file to key: 4c40zukthfnmdvhtuucgbync4vlb (checksum: JATuvF8vQO1Ak66jZ7GYAA==)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Update (4.6ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 9 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 9 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Load (0.3ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 9 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Update (0.4ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-29 10:15:27.354837' WHERE "documents"."id" = 9 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 9 AND "active_storage_attachments"."record_type" = 'ActiveStorage::Blob' AND "active_storage_attachments"."name" = 'preview_image' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[ActiveJob] Enqueued AnalyzeDocumentJob (Job ID: 6db45dce-16ec-4a7c-b405-be4528262e7c) to Async(default) with arguments: 9
[ActiveJob] â†³ app/controllers/documents_controller.rb:11:in 'DocumentsController#create'
Completed 201 Created in 1521ms (Views: 0.1ms | ActiveRecord: 35.3ms (10 queries, 0 cached) | GC: 0.2ms)


[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c] Performing AnalyzeDocumentJob (Job ID: 6db45dce-16ec-4a7c-b405-be4528262e7c) from Async(default) enqueued at 2025-12-29T10:15:28.396302500Z with arguments: 9
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   [1m[36mDocument Load (0.7ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 9 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   â†³ app/jobs/analyze_document_job.rb:6:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   [1m[36mActiveStorage::Attachment Load (4.4ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 9 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   [1m[36mActiveStorage::Blob Load (0.4ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 9 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   â†³ app/models/document.rb:17:in 'Document#original_file_mime_type'
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   [1m[36mDocument Update (0.4ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'processing', "updated_at" = '2025-12-29 10:15:28.437938' WHERE "documents"."id" = 9 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c] [36m  Disk Storage (0.3ms) [0m[34mDownloaded file from key: 4c40zukthfnmdvhtuucgbync4vlb[0m
Started GET "/documents/9" for ::1 at 2025-12-29 11:15:30 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "9"}
  [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 9 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/documents/9" for ::1 at 2025-12-29 11:15:32 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "9"}
  [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 9 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


Started GET "/documents/9" for ::1 at 2025-12-29 11:15:34 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "9"}
  [1m[36mDocument Load (0.3ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 9 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)


[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   [1m[36mDocument Update (7.5ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'completed', "doc_type" = 'Cedolino', "ai_data" = '{"tipo_documento":"Cedolino","data_competenza":"08/05/2017","codice_fiscale":"LZNNR58A41D548V","dipendente":"FERRARA (FE)"}', "updated_at" = '2025-12-29 10:15:35.155822' WHERE "documents"."id" = 9 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [6db45dce-16ec-4a7c-b405-be4528262e7c] Performed AnalyzeDocumentJob (Job ID: 6db45dce-16ec-4a7c-b405-be4528262e7c) from Async(default) in 6752.63ms
Started GET "/documents/9" for ::1 at 2025-12-29 11:15:36 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "9"}
  [1m[36mDocument Load (2.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 9 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 2.4ms (1 query, 0 cached) | GC: 0.0ms)


Started POST "/documents" for ::1 at 2025-12-29 11:16:43 +0100
Processing by DocumentsController#create as */*
  Parameters: {"document" => {"original_file" => #<ActionDispatch::Http::UploadedFile:0x00000271ffb67b28 @tempfile=#<Tempfile:C:/Users/marco/AppData/Local/Temp/RackMultipart20251229-3600-fiywrd.pdf>, @content_type="application/pdf", @original_filename="Busta paga ESEMPIO.pdf", @headers="Content-Disposition: form-data; name=\"document[original_file]\"; filename=\"Busta paga ESEMPIO.pdf\"\r\nContent-Type: application/pdf\r\n">}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Create (3.6ms)[0m  [1m[32mINSERT INTO "documents" ("status", "doc_type", "ai_data", "created_at", "updated_at") VALUES ('pending', NULL, NULL, '2025-12-29 10:16:43.964187', '2025-12-29 10:16:43.964187') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.6ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 10 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Create (0.4ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("key", "filename", "content_type", "metadata", "service_name", "byte_size", "checksum", "created_at") VALUES ('kwtxmf14tvtb6dakzndgnwmimskc', 'Busta paga ESEMPIO.pdf', 'application/pdf', '{"identified":true}', 'local', 90794, 'xEiMiXyfJrlwKOdFJ+f4MA==', '2025-12-29 10:16:43.977657') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Create (0.6ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("name", "record_type", "record_id", "blob_id", "created_at") VALUES ('original_file', 'Document', 10, 10, '2025-12-29 10:16:43.983896') RETURNING "id" /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Update (0.5ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-29 10:16:43.989451' WHERE "documents"."id" = 10 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[36m  Disk Storage (20.0ms) [0m[32mUploaded file to key: kwtxmf14tvtb6dakzndgnwmimskc (checksum: xEiMiXyfJrlwKOdFJ+f4MA==)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Blob Update (6.0ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = '{"identified":true,"analyzed":true}' WHERE "active_storage_blobs"."id" = 10 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.5ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = 10 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 10 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mDocument Update (0.3ms)[0m  [1m[33mUPDATE "documents" SET "updated_at" = '2025-12-29 10:16:44.048785' WHERE "documents"."id" = 10 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
  [1m[36mActiveStorage::Attachment Load (0.6ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 10 AND "active_storage_attachments"."record_type" = 'ActiveStorage::Blob' AND "active_storage_attachments"."name" = 'preview_image' LIMIT 1 /*action='create',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:9:in 'DocumentsController#create'
[ActiveJob] Enqueued AnalyzeDocumentJob (Job ID: 297b8df7-aaa0-4ca1-89b1-8af1ce97343c) to Async(default) with arguments: 10
[ActiveJob] â†³ app/controllers/documents_controller.rb:11:in 'DocumentsController#create'
Completed 201 Created in 119ms (Views: 0.2ms | ActiveRecord: 14.8ms (10 queries, 0 cached) | GC: 0.0ms)


[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c] Performing AnalyzeDocumentJob (Job ID: 297b8df7-aaa0-4ca1-89b1-8af1ce97343c) from Async(default) enqueued at 2025-12-29T10:16:44.063033300Z with arguments: 10
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   [1m[36mDocument Load (0.5ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 10 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   â†³ app/jobs/analyze_document_job.rb:6:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   [1m[36mActiveStorage::Attachment Load (7.8ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = 10 AND "active_storage_attachments"."record_type" = 'Document' AND "active_storage_attachments"."name" = 'original_file' LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   [1m[36mActiveStorage::Blob Load (0.5ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = 10 LIMIT 1 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   â†³ app/models/document.rb:17:in 'Document#original_file_mime_type'
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   [1m[36mDocument Update (0.4ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'processing', "updated_at" = '2025-12-29 10:16:44.112149' WHERE "documents"."id" = 10 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   â†³ app/jobs/analyze_document_job.rb:7:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c] [36m  Disk Storage (0.6ms) [0m[34mDownloaded file from key: kwtxmf14tvtb6dakzndgnwmimskc[0m
Started GET "/documents/10" for ::1 at 2025-12-29 11:16:46 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "10"}
  [1m[36mDocument Load (0.5ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 10 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)


[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   [1m[36mDocument Update (4.0ms)[0m  [1m[33mUPDATE "documents" SET "status" = 'completed', "doc_type" = 'Cedolino', "ai_data" = '{"tipo_documento":"Cedolino","data_competenza":"08/05/2017","codice_fiscale":"LNAR85A41D548V","dipendente":"FERRARA NATA A"}', "updated_at" = '2025-12-29 10:16:47.977970' WHERE "documents"."id" = 10 /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT /*application='NexumPoc',job='AnalyzeDocumentJob'*/[0m
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c]   â†³ app/jobs/analyze_document_job.rb:13:in 'AnalyzeDocumentJob#perform'
[ActiveJob] [AnalyzeDocumentJob] [297b8df7-aaa0-4ca1-89b1-8af1ce97343c] Performed AnalyzeDocumentJob (Job ID: 297b8df7-aaa0-4ca1-89b1-8af1ce97343c) from Async(default) in 3908.34ms
Started GET "/documents/10" for ::1 at 2025-12-29 11:16:48 +0100
Processing by DocumentsController#show as */*
  Parameters: {"id" => "10"}
  [1m[36mDocument Load (0.4ms)[0m  [1m[34mSELECT "documents".* FROM "documents" WHERE "documents"."id" = 10 LIMIT 1 /*action='show',application='NexumPoc',controller='documents'*/[0m
  â†³ app/controllers/documents_controller.rb:21:in 'DocumentsController#show'
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)


